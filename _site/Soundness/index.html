<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Soundness: of reduction with respect to denotational semantics | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Soundness: of reduction with respect to denotational semantics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Programming Language Foundations in Agda" />
<meta property="og:description" content="Programming Language Foundations in Agda" />
<link rel="canonical" href="https://plfa.github.io/Soundness/" />
<meta property="og:url" content="https://plfa.github.io/Soundness/" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<script type="application/ld+json">
{"description":"Programming Language Foundations in Agda","@type":"WebPage","url":"https://plfa.github.io/Soundness/","headline":"Soundness: of reduction with respect to denotational semantics","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">Table of Contents</a>
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Soundness: of reduction with respect to denotational semantics</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="192" class="Keyword">module</a> <a id="199" href="/Soundness/" class="Module">plfa.Soundness</a> <a id="214" class="Keyword">where</a></pre>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="257" class="Keyword">open</a> <a id="262" class="Keyword">import</a> <a id="269" href="/Untyped/" class="Module">plfa.Untyped</a>
  <a id="284" class="Keyword">using</a> <a id="290" class="Symbol">(</a><a id="291" href="/Untyped/#2980" class="Datatype">Context</a><a id="298" class="Symbol">;</a> <a id="300" href="/Untyped/#3018" class="InductiveConstructor Operator">_,_</a><a id="303" class="Symbol">;</a> <a id="305" href="/Untyped/#3365" class="Datatype Operator">_∋_</a><a id="308" class="Symbol">;</a> <a id="310" href="/Untyped/#4150" class="Datatype Operator">_⊢_</a><a id="313" class="Symbol">;</a> <a id="315" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="316" class="Symbol">;</a> <a id="318" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="319" class="Symbol">;</a> <a id="321" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a><a id="323" class="Symbol">;</a> <a id="325" href="/Untyped/#4186" class="InductiveConstructor Operator">`_</a><a id="327" class="Symbol">;</a> <a id="329" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ_</a><a id="331" class="Symbol">;</a> <a id="333" href="/Untyped/#4298" class="InductiveConstructor Operator">_·_</a><a id="336" class="Symbol">;</a>
         <a id="347" href="/Untyped/#6931" class="Function">subst</a><a id="352" class="Symbol">;</a> <a id="354" href="/Untyped/#7475" class="Function Operator">_[_]</a><a id="358" class="Symbol">;</a> <a id="360" href="/Untyped/#7359" class="Function">subst-zero</a><a id="370" class="Symbol">;</a> <a id="372" href="/Untyped/#5845" class="Function">ext</a><a id="375" class="Symbol">;</a> <a id="377" href="/Untyped/#6171" class="Function">rename</a><a id="383" class="Symbol">;</a> <a id="385" href="/Untyped/#6623" class="Function">exts</a><a id="389" class="Symbol">)</a>
<a id="391" class="Keyword">open</a> <a id="396" class="Keyword">import</a> <a id="403" href="/LambdaReduction/" class="Module">plfa.LambdaReduction</a>
  <a id="426" class="Keyword">using</a> <a id="432" class="Symbol">(</a><a id="433" href="/LambdaReduction/#386" class="Datatype Operator">_—→_</a><a id="437" class="Symbol">;</a> <a id="439" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a><a id="441" class="Symbol">;</a> <a id="443" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a><a id="445" class="Symbol">;</a> <a id="447" href="/LambdaReduction/#616" class="InductiveConstructor">β</a><a id="448" class="Symbol">;</a> <a id="450" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a><a id="451" class="Symbol">;</a> <a id="453" href="/LambdaReduction/#894" class="Datatype Operator">_—↠_</a><a id="457" class="Symbol">;</a> <a id="459" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">_—→⟨_⟩_</a><a id="466" class="Symbol">;</a> <a id="468" href="/LambdaReduction/#944" class="InductiveConstructor Operator">_[]</a><a id="471" class="Symbol">)</a>
<a id="473" class="Keyword">open</a> <a id="478" class="Keyword">import</a> <a id="485" href="/Denotational/" class="Module">plfa.Denotational</a>
<a id="503" class="Keyword">open</a> <a id="508" class="Keyword">import</a> <a id="515" href="/Compositional/" class="Module">plfa.Compositional</a>

<a id="535" class="Keyword">open</a> <a id="540" class="Keyword">import</a> <a id="547" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="587" class="Keyword">using</a> <a id="593" class="Symbol">(</a><a id="594" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a><a id="597" class="Symbol">;</a> <a id="599" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">_≢_</a><a id="602" class="Symbol">;</a> <a id="604" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="608" class="Symbol">;</a> <a id="610" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a><a id="613" class="Symbol">;</a> <a id="615" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1170" class="Function">cong</a><a id="619" class="Symbol">;</a> <a id="621" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1408" class="Function">cong₂</a><a id="626" class="Symbol">;</a> <a id="628" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.html#1274" class="Function">cong-app</a><a id="636" class="Symbol">)</a>
<a id="638" class="Keyword">open</a> <a id="643" class="Keyword">import</a> <a id="650" href="https://agda.github.io/agda-stdlib/Data.Product.html" class="Module">Data.Product</a> <a id="663" class="Keyword">using</a> <a id="669" class="Symbol">(</a><a id="670" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">_×_</a><a id="673" class="Symbol">;</a> <a id="675" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#69" class="Record">Σ</a><a id="676" class="Symbol">;</a> <a id="678" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ-syntax</a><a id="686" class="Symbol">;</a> <a id="688" href="https://agda.github.io/agda-stdlib/Data.Product.html#881" class="Function">∃</a><a id="689" class="Symbol">;</a> <a id="691" href="https://agda.github.io/agda-stdlib/Data.Product.html#942" class="Function">∃-syntax</a><a id="699" class="Symbol">;</a> <a id="701" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a><a id="706" class="Symbol">;</a> <a id="708" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#167" class="Field">proj₂</a><a id="713" class="Symbol">)</a>
  <a id="717" class="Keyword">renaming</a> <a id="726" class="Symbol">(</a><a id="727" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">_,_</a> <a id="731" class="Symbol">to</a> <a id="734" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="739" class="Symbol">)</a>
<a id="741" class="Keyword">open</a> <a id="746" class="Keyword">import</a> <a id="753" href="https://agda.github.io/agda-stdlib/Data.Sum.html" class="Module">Data.Sum</a>
<a id="762" class="Keyword">open</a> <a id="767" class="Keyword">import</a> <a id="774" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="789" class="Keyword">using</a> <a id="795" class="Symbol">(</a><a id="796" href="https://agda.github.io/agda-stdlib/Agda.Primitive.html#611" class="Primitive">lzero</a><a id="801" class="Symbol">)</a>
<a id="803" class="Keyword">open</a> <a id="808" class="Keyword">import</a> <a id="815" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="832" class="Keyword">using</a> <a id="838" class="Symbol">(</a><a id="839" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#464" class="Function Operator">¬_</a><a id="841" class="Symbol">)</a>
<a id="843" class="Keyword">open</a> <a id="848" class="Keyword">import</a> <a id="855" href="https://agda.github.io/agda-stdlib/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="881" class="Keyword">using</a> <a id="887" class="Symbol">(</a><a id="888" href="https://agda.github.io/agda-stdlib/Relation.Nullary.Negation.html#560" class="Function">contradiction</a><a id="901" class="Symbol">)</a>
<a id="903" class="Keyword">open</a> <a id="908" class="Keyword">import</a> <a id="915" href="https://agda.github.io/agda-stdlib/Data.Empty.html" class="Module">Data.Empty</a> <a id="926" class="Keyword">using</a> <a id="932" class="Symbol">(</a><a id="933" href="https://agda.github.io/agda-stdlib/Data.Empty.html#360" class="Function">⊥-elim</a><a id="939" class="Symbol">)</a>
<a id="941" class="Keyword">open</a> <a id="946" class="Keyword">import</a> <a id="953" href="https://agda.github.io/agda-stdlib/Data.Unit.html" class="Module">Data.Unit</a>
<a id="963" class="Keyword">open</a> <a id="968" class="Keyword">import</a> <a id="975" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="992" class="Keyword">using</a> <a id="998" class="Symbol">(</a><a id="999" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#534" class="Datatype">Dec</a><a id="1002" class="Symbol">;</a> <a id="1004" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a><a id="1007" class="Symbol">;</a> <a id="1009" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a><a id="1011" class="Symbol">)</a>
<a id="1013" class="Keyword">open</a> <a id="1018" class="Keyword">import</a> <a id="1025" href="https://agda.github.io/agda-stdlib/Function.html" class="Module">Function</a> <a id="1034" class="Keyword">using</a> <a id="1040" class="Symbol">(</a><a id="1041" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">_∘_</a><a id="1044" class="Symbol">)</a>
<a id="1046" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a></pre>

<p>In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e., for any term L</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>L —↠ ƛ N  implies  ℰ L ≃ ℰ (ƛ N)
</code></pre></div></div>

<p>The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if any term <code class="highlighter-rouge">M</code> steps
to a term <code class="highlighter-rouge">N</code>, then <code class="highlighter-rouge">M</code> and <code class="highlighter-rouge">N</code> are denotationally equal. We shall
prove each direction of this if-and-only-if separately. One direction
will look just like a type preservation proof. The other direction is
like proving type preservation for reduction going in reverse.  Recall
that type preservation is sometimes called subject
reduction. Preservation in reverse is a well-known property and is
called <em>subject expansion</em>. It is also well-known that subject
expansion is false for most typed lambda calculi!</p>

<h2 id="forward-reduction-preserves-denotations">Forward reduction preserves denotations</h2>

<p>The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.</p>

<p>The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.</p>

<h3 id="simultaneous-substitution-preserves-denotations">Simultaneous substitution preserves denotations</h3>

<p>We introduce the following shorthand for the type of a substitution
from variables in context <code class="highlighter-rouge">Γ</code> to terms in context <code class="highlighter-rouge">Δ</code>.</p>

<pre class="Agda"><a id="Subst"></a><a id="2673" href="/Soundness/#2673" class="Function">Subst</a> <a id="2679" class="Symbol">:</a> <a id="2681" href="/Untyped/#2980" class="Datatype">Context</a> <a id="2689" class="Symbol">→</a> <a id="2691" href="/Untyped/#2980" class="Datatype">Context</a> <a id="2699" class="Symbol">→</a> <a id="2701" class="PrimitiveType">Set</a>
<a id="2705" href="/Soundness/#2673" class="Function">Subst</a> <a id="2711" href="/Soundness/#2711" class="Bound">Γ</a> <a id="2713" href="/Soundness/#2713" class="Bound">Δ</a> <a id="2715" class="Symbol">=</a> <a id="2717" class="Symbol">∀{</a><a id="2719" href="/Soundness/#2719" class="Bound">A</a><a id="2720" class="Symbol">}</a> <a id="2722" class="Symbol">→</a> <a id="2724" href="/Soundness/#2711" class="Bound">Γ</a> <a id="2726" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="2728" href="/Soundness/#2719" class="Bound">A</a> <a id="2730" class="Symbol">→</a> <a id="2732" href="/Soundness/#2713" class="Bound">Δ</a> <a id="2734" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="2736" href="/Soundness/#2719" class="Bound">A</a></pre>

<p>Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if <code class="highlighter-rouge">M</code> results in <code class="highlighter-rouge">v</code> in environment <code class="highlighter-rouge">γ</code>, then applying a
substitution <code class="highlighter-rouge">σ</code> to <code class="highlighter-rouge">M</code> gives us a program that also results in <code class="highlighter-rouge">v</code>, but in
an environment <code class="highlighter-rouge">δ</code> in which, for every variable <code class="highlighter-rouge">x</code>, <code class="highlighter-rouge">σ x</code> results in the
same value as the one for <code class="highlighter-rouge">x</code> in the original environment <code class="highlighter-rouge">γ</code>.
We write <code class="highlighter-rouge">δ ⊢ σ ↓ γ</code> for this condition.</p>

<pre class="Agda"><a id="3162" class="Keyword">infix</a> <a id="3168" class="Number">3</a> <a id="3170" href="/Soundness/#3177" class="Function Operator">_`⊢_↓_</a>
<a id="_`⊢_↓_"></a><a id="3177" href="/Soundness/#3177" class="Function Operator">_`⊢_↓_</a> <a id="3184" class="Symbol">:</a> <a id="3186" class="Symbol">∀{</a><a id="3188" href="/Soundness/#3188" class="Bound">Δ</a> <a id="3190" href="/Soundness/#3190" class="Bound">Γ</a><a id="3191" class="Symbol">}</a> <a id="3193" class="Symbol">→</a> <a id="3195" href="/Denotational/#7331" class="Function">Env</a> <a id="3199" href="/Soundness/#3188" class="Bound">Δ</a> <a id="3201" class="Symbol">→</a> <a id="3203" href="/Soundness/#2673" class="Function">Subst</a> <a id="3209" href="/Soundness/#3190" class="Bound">Γ</a> <a id="3211" href="/Soundness/#3188" class="Bound">Δ</a> <a id="3213" class="Symbol">→</a> <a id="3215" href="/Denotational/#7331" class="Function">Env</a> <a id="3219" href="/Soundness/#3190" class="Bound">Γ</a> <a id="3221" class="Symbol">→</a> <a id="3223" class="PrimitiveType">Set</a>
<a id="3227" href="/Soundness/#3177" class="Function Operator">_`⊢_↓_</a> <a id="3234" class="Symbol">{</a><a id="3235" href="/Soundness/#3235" class="Bound">Δ</a><a id="3236" class="Symbol">}{</a><a id="3238" href="/Soundness/#3238" class="Bound">Γ</a><a id="3239" class="Symbol">}</a> <a id="3241" href="/Soundness/#3241" class="Bound">δ</a> <a id="3243" href="/Soundness/#3243" class="Bound">σ</a> <a id="3245" href="/Soundness/#3245" class="Bound">γ</a> <a id="3247" class="Symbol">=</a> <a id="3249" class="Symbol">(∀</a> <a id="3252" class="Symbol">(</a><a id="3253" href="/Soundness/#3253" class="Bound">x</a> <a id="3255" class="Symbol">:</a> <a id="3257" href="/Soundness/#3238" class="Bound">Γ</a> <a id="3259" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="3261" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="3262" class="Symbol">)</a> <a id="3264" class="Symbol">→</a> <a id="3266" href="/Soundness/#3241" class="Bound">δ</a> <a id="3268" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="3270" href="/Soundness/#3243" class="Bound">σ</a> <a id="3272" href="/Soundness/#3253" class="Bound">x</a> <a id="3274" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="3276" href="/Soundness/#3245" class="Bound">γ</a> <a id="3278" href="/Soundness/#3253" class="Bound">x</a><a id="3279" class="Symbol">)</a></pre>

<p>As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the <code class="highlighter-rouge">exts</code> function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in <code class="highlighter-rouge">δ , v</code> produce the values in <code class="highlighter-rouge">γ , v</code>.</p>

<pre class="Agda"><a id="subst-ext"></a><a id="3560" href="/Soundness/#3560" class="Function">subst-ext</a> <a id="3570" class="Symbol">:</a> <a id="3572" class="Symbol">∀</a> <a id="3574" class="Symbol">{</a><a id="3575" href="/Soundness/#3575" class="Bound">Γ</a> <a id="3577" href="/Soundness/#3577" class="Bound">Δ</a> <a id="3579" href="/Soundness/#3579" class="Bound">v</a><a id="3580" class="Symbol">}</a> <a id="3582" class="Symbol">{</a><a id="3583" href="/Soundness/#3583" class="Bound">γ</a> <a id="3585" class="Symbol">:</a> <a id="3587" href="/Denotational/#7331" class="Function">Env</a> <a id="3591" href="/Soundness/#3575" class="Bound">Γ</a><a id="3592" class="Symbol">}</a> <a id="3594" class="Symbol">{</a><a id="3595" href="/Soundness/#3595" class="Bound">δ</a> <a id="3597" class="Symbol">:</a> <a id="3599" href="/Denotational/#7331" class="Function">Env</a> <a id="3603" href="/Soundness/#3577" class="Bound">Δ</a><a id="3604" class="Symbol">}</a>
  <a id="3608" class="Symbol">→</a> <a id="3610" class="Symbol">(</a><a id="3611" href="/Soundness/#3611" class="Bound">σ</a> <a id="3613" class="Symbol">:</a> <a id="3615" href="/Soundness/#2673" class="Function">Subst</a> <a id="3621" href="/Soundness/#3575" class="Bound">Γ</a> <a id="3623" href="/Soundness/#3577" class="Bound">Δ</a><a id="3624" class="Symbol">)</a>
  <a id="3628" class="Symbol">→</a> <a id="3630" href="/Soundness/#3595" class="Bound">δ</a> <a id="3632" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="3635" href="/Soundness/#3611" class="Bound">σ</a> <a id="3637" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="3639" href="/Soundness/#3583" class="Bound">γ</a>
   <a id="3644" class="Comment">--------------------------</a>
  <a id="3673" class="Symbol">→</a> <a id="3675" href="/Soundness/#3595" class="Bound">δ</a> <a id="3677" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="3680" href="/Soundness/#3579" class="Bound">v</a> <a id="3682" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="3685" href="/Untyped/#6623" class="Function">exts</a> <a id="3690" href="/Soundness/#3611" class="Bound">σ</a> <a id="3692" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="3694" href="/Soundness/#3583" class="Bound">γ</a> <a id="3696" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="3699" href="/Soundness/#3579" class="Bound">v</a>
<a id="3701" href="/Soundness/#3560" class="Function">subst-ext</a> <a id="3711" href="/Soundness/#3711" class="Bound">σ</a> <a id="3713" href="/Soundness/#3713" class="Bound">d</a> <a id="3715" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="3717" class="Symbol">=</a> <a id="3719" href="/Denotational/#9925" class="InductiveConstructor">var</a>
<a id="3723" href="/Soundness/#3560" class="Function">subst-ext</a> <a id="3733" href="/Soundness/#3733" class="Bound">σ</a> <a id="3735" href="/Soundness/#3735" class="Bound">d</a> <a id="3737" class="Symbol">(</a><a id="3738" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="3740" href="/Soundness/#3740" class="Bound">x</a><a id="3741" class="Symbol">)</a> <a id="3743" class="Symbol">=</a> <a id="3745" href="/Denotational/#24146" class="Function">rename-pres</a> <a id="3757" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="3760" class="Symbol">(λ</a> <a id="3763" href="/Soundness/#3763" class="Bound">_</a> <a id="3765" class="Symbol">→</a> <a id="3767" href="/Denotational/#5638" class="Function">Refl⊑</a><a id="3772" class="Symbol">)</a> <a id="3774" class="Symbol">(</a><a id="3775" href="/Soundness/#3735" class="Bound">d</a> <a id="3777" href="/Soundness/#3740" class="Bound">x</a><a id="3778" class="Symbol">)</a></pre>

<p>The proof is by cases on the de Bruijn index <code class="highlighter-rouge">x</code>.</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then we need to show that <code class="highlighter-rouge">δ , v ⊢ # 0 ↓ v</code>,
which we have by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x'</code>,then we need to show that 
<code class="highlighter-rouge">δ , v ⊢ rename S_ (σ x') ↓ nth x' γ</code>,
which we obtain by the <code class="highlighter-rouge">rename-pres</code> lemma.</p>
  </li>
</ul>

<p>With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let’s dive in!</p>

<pre class="Agda"><a id="subst-pres"></a><a id="4212" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4223" class="Symbol">:</a> <a id="4225" class="Symbol">∀</a> <a id="4227" class="Symbol">{</a><a id="4228" href="/Soundness/#4228" class="Bound">Γ</a> <a id="4230" href="/Soundness/#4230" class="Bound">Δ</a> <a id="4232" href="/Soundness/#4232" class="Bound">v</a><a id="4233" class="Symbol">}</a> <a id="4235" class="Symbol">{</a><a id="4236" href="/Soundness/#4236" class="Bound">γ</a> <a id="4238" class="Symbol">:</a> <a id="4240" href="/Denotational/#7331" class="Function">Env</a> <a id="4244" href="/Soundness/#4228" class="Bound">Γ</a><a id="4245" class="Symbol">}</a> <a id="4247" class="Symbol">{</a><a id="4248" href="/Soundness/#4248" class="Bound">δ</a> <a id="4250" class="Symbol">:</a> <a id="4252" href="/Denotational/#7331" class="Function">Env</a> <a id="4256" href="/Soundness/#4230" class="Bound">Δ</a><a id="4257" class="Symbol">}</a> <a id="4259" class="Symbol">{</a><a id="4260" href="/Soundness/#4260" class="Bound">M</a> <a id="4262" class="Symbol">:</a> <a id="4264" href="/Soundness/#4228" class="Bound">Γ</a> <a id="4266" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="4268" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="4269" class="Symbol">}</a>
  <a id="4273" class="Symbol">→</a> <a id="4275" class="Symbol">(</a><a id="4276" href="/Soundness/#4276" class="Bound">σ</a> <a id="4278" class="Symbol">:</a> <a id="4280" href="/Soundness/#2673" class="Function">Subst</a> <a id="4286" href="/Soundness/#4228" class="Bound">Γ</a> <a id="4288" href="/Soundness/#4230" class="Bound">Δ</a><a id="4289" class="Symbol">)</a>
  <a id="4293" class="Symbol">→</a> <a id="4295" href="/Soundness/#4248" class="Bound">δ</a> <a id="4297" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="4300" href="/Soundness/#4276" class="Bound">σ</a> <a id="4302" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="4304" href="/Soundness/#4236" class="Bound">γ</a>
  <a id="4308" class="Symbol">→</a> <a id="4310" href="/Soundness/#4236" class="Bound">γ</a> <a id="4312" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="4314" href="/Soundness/#4260" class="Bound">M</a> <a id="4316" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="4318" href="/Soundness/#4232" class="Bound">v</a>
    <a id="4324" class="Comment">------------------</a>
  <a id="4345" class="Symbol">→</a> <a id="4347" href="/Soundness/#4248" class="Bound">δ</a> <a id="4349" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="4351" href="/Untyped/#6931" class="Function">subst</a> <a id="4357" href="/Soundness/#4276" class="Bound">σ</a> <a id="4359" href="/Soundness/#4260" class="Bound">M</a> <a id="4361" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="4363" href="/Soundness/#4232" class="Bound">v</a>
<a id="4365" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4376" href="/Soundness/#4376" class="Bound">σ</a> <a id="4378" href="/Soundness/#4378" class="Bound">s</a> <a id="4380" class="Symbol">(</a><a id="4381" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="4385" class="Symbol">{</a><a id="4386" class="Argument">x</a> <a id="4388" class="Symbol">=</a> <a id="4390" href="/Soundness/#4390" class="Bound">x</a><a id="4391" class="Symbol">})</a> <a id="4394" class="Symbol">=</a> <a id="4396" class="Symbol">(</a><a id="4397" href="/Soundness/#4378" class="Bound">s</a> <a id="4399" href="/Soundness/#4390" class="Bound">x</a><a id="4400" class="Symbol">)</a>
<a id="4402" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4413" href="/Soundness/#4413" class="Bound">σ</a> <a id="4415" href="/Soundness/#4415" class="Bound">s</a> <a id="4417" class="Symbol">(</a><a id="4418" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="4425" href="/Soundness/#4425" class="Bound">d₁</a> <a id="4428" href="/Soundness/#4428" class="Bound">d₂</a><a id="4430" class="Symbol">)</a> <a id="4432" class="Symbol">=</a>
  <a id="4436" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="4443" class="Symbol">(</a><a id="4444" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4455" href="/Soundness/#4413" class="Bound">σ</a> <a id="4457" href="/Soundness/#4415" class="Bound">s</a> <a id="4459" href="/Soundness/#4425" class="Bound">d₁</a><a id="4461" class="Symbol">)</a> <a id="4463" class="Symbol">(</a><a id="4464" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4475" href="/Soundness/#4413" class="Bound">σ</a> <a id="4477" href="/Soundness/#4415" class="Bound">s</a> <a id="4479" href="/Soundness/#4428" class="Bound">d₂</a><a id="4481" class="Symbol">)</a> 
<a id="4484" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4495" href="/Soundness/#4495" class="Bound">σ</a> <a id="4497" href="/Soundness/#4497" class="Bound">s</a> <a id="4499" class="Symbol">(</a><a id="4500" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="4508" href="/Soundness/#4508" class="Bound">d</a><a id="4509" class="Symbol">)</a> <a id="4511" class="Symbol">=</a>
  <a id="4515" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="4523" class="Symbol">(</a><a id="4524" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4535" class="Symbol">(λ</a> <a id="4538" class="Symbol">{</a><a id="4539" href="/Soundness/#4539" class="Bound">A</a><a id="4540" class="Symbol">}</a> <a id="4542" class="Symbol">→</a> <a id="4544" href="/Untyped/#6623" class="Function">exts</a> <a id="4549" href="/Soundness/#4495" class="Bound">σ</a><a id="4550" class="Symbol">)</a> <a id="4552" class="Symbol">(</a><a id="4553" href="/Soundness/#3560" class="Function">subst-ext</a> <a id="4563" href="/Soundness/#4495" class="Bound">σ</a> <a id="4565" href="/Soundness/#4497" class="Bound">s</a><a id="4566" class="Symbol">)</a> <a id="4568" href="/Soundness/#4508" class="Bound">d</a><a id="4569" class="Symbol">)</a>
<a id="4571" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4582" href="/Soundness/#4582" class="Bound">σ</a> <a id="4584" href="/Soundness/#4584" class="Bound">s</a> <a id="4586" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="4594" class="Symbol">=</a> <a id="4596" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a>
<a id="4604" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4615" href="/Soundness/#4615" class="Bound">σ</a> <a id="4617" href="/Soundness/#4617" class="Bound">s</a> <a id="4619" class="Symbol">(</a><a id="4620" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="4628" href="/Soundness/#4628" class="Bound">d₁</a> <a id="4631" href="/Soundness/#4631" class="Bound">d₂</a><a id="4633" class="Symbol">)</a> <a id="4635" class="Symbol">=</a>
  <a id="4639" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="4647" class="Symbol">(</a><a id="4648" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4659" href="/Soundness/#4615" class="Bound">σ</a> <a id="4661" href="/Soundness/#4617" class="Bound">s</a> <a id="4663" href="/Soundness/#4628" class="Bound">d₁</a><a id="4665" class="Symbol">)</a> <a id="4667" class="Symbol">(</a><a id="4668" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4679" href="/Soundness/#4615" class="Bound">σ</a> <a id="4681" href="/Soundness/#4617" class="Bound">s</a> <a id="4683" href="/Soundness/#4631" class="Bound">d₂</a><a id="4685" class="Symbol">)</a>
<a id="4687" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4698" href="/Soundness/#4698" class="Bound">σ</a> <a id="4700" href="/Soundness/#4700" class="Bound">s</a> <a id="4702" class="Symbol">(</a><a id="4703" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="4707" href="/Soundness/#4707" class="Bound">d</a> <a id="4709" href="/Soundness/#4709" class="Bound">lt</a><a id="4711" class="Symbol">)</a> <a id="4713" class="Symbol">=</a> <a id="4715" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="4719" class="Symbol">(</a><a id="4720" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="4731" href="/Soundness/#4698" class="Bound">σ</a> <a id="4733" href="/Soundness/#4700" class="Bound">s</a> <a id="4735" href="/Soundness/#4707" class="Bound">d</a><a id="4736" class="Symbol">)</a> <a id="4738" href="/Soundness/#4709" class="Bound">lt</a></pre>

<p>The proof is by induction on the semantics of <code class="highlighter-rouge">M</code>.  The two interesting
cases are for variables and lambda abstractions.</p>

<ul>
  <li>
    <p>For a variable <code class="highlighter-rouge">x</code>, we have that <code class="highlighter-rouge">v ⊑ nth x γ</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ σ x ↓ v</code>.  From the premise applied to <code class="highlighter-rouge">x</code>, we have that
<code class="highlighter-rouge">δ ⊢ σ x ↓ nth x γ</code>, so we conclude by the <code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>For a lambda abstraction, we must extend the substitution
for the induction hypothesis. We apply the <code class="highlighter-rouge">subst-ext</code> lemma
to show that the extended substitution maps variables to
terms that result in the appropriate values.</p>
  </li>
</ul>

<h3 id="single-substitution-preserves-denotations">Single substitution preserves denotations</h3>

<p>For β reduction, <code class="highlighter-rouge">(ƛ N) · M —→ N [ M ]</code>, we need to show that the
semantics is preserved when substituting <code class="highlighter-rouge">M</code> for de Bruijn index 0 in
term <code class="highlighter-rouge">N</code>. By inversion on the rules <code class="highlighter-rouge">↦-elim</code> and <code class="highlighter-rouge">↦-intro</code>,
we have that <code class="highlighter-rouge">γ , v ⊢ M ↓ w</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code>.
So we need to show that <code class="highlighter-rouge">γ ⊢ M [ N ] ↓ w</code>, or equivalently,
that <code class="highlighter-rouge">γ ⊢ subst (subst-zero N) M ↓ w</code>.</p>

<pre class="Agda"><a id="substitution"></a><a id="5704" href="/Soundness/#5704" class="Function">substitution</a> <a id="5717" class="Symbol">:</a> <a id="5719" class="Symbol">∀</a> <a id="5721" class="Symbol">{</a><a id="5722" href="/Soundness/#5722" class="Bound">Γ</a><a id="5723" class="Symbol">}</a> <a id="5725" class="Symbol">{</a><a id="5726" href="/Soundness/#5726" class="Bound">γ</a> <a id="5728" class="Symbol">:</a> <a id="5730" href="/Denotational/#7331" class="Function">Env</a> <a id="5734" href="/Soundness/#5722" class="Bound">Γ</a><a id="5735" class="Symbol">}</a> <a id="5737" class="Symbol">{</a><a id="5738" href="/Soundness/#5738" class="Bound">N</a> <a id="5740" href="/Soundness/#5740" class="Bound">M</a> <a id="5742" href="/Soundness/#5742" class="Bound">v</a> <a id="5744" href="/Soundness/#5744" class="Bound">w</a><a id="5745" class="Symbol">}</a>
   <a id="5750" class="Symbol">→</a> <a id="5752" href="/Soundness/#5726" class="Bound">γ</a> <a id="5754" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="5757" href="/Soundness/#5742" class="Bound">v</a> <a id="5759" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="5761" href="/Soundness/#5738" class="Bound">N</a> <a id="5763" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="5765" href="/Soundness/#5744" class="Bound">w</a>
   <a id="5770" class="Symbol">→</a> <a id="5772" href="/Soundness/#5726" class="Bound">γ</a> <a id="5774" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="5776" href="/Soundness/#5740" class="Bound">M</a> <a id="5778" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="5780" href="/Soundness/#5742" class="Bound">v</a>
     <a id="5787" class="Comment">---------------</a>
   <a id="5806" class="Symbol">→</a> <a id="5808" href="/Soundness/#5726" class="Bound">γ</a> <a id="5810" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="5812" href="/Soundness/#5738" class="Bound">N</a> <a id="5814" href="/Untyped/#7475" class="Function Operator">[</a> <a id="5816" href="/Soundness/#5740" class="Bound">M</a> <a id="5818" href="/Untyped/#7475" class="Function Operator">]</a> <a id="5820" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="5822" href="/Soundness/#5744" class="Bound">w</a>   
<a id="5827" href="/Soundness/#5704" class="Function">substitution</a><a id="5839" class="Symbol">{</a><a id="5840" href="/Soundness/#5840" class="Bound">Γ</a><a id="5841" class="Symbol">}{</a><a id="5843" href="/Soundness/#5843" class="Bound">γ</a><a id="5844" class="Symbol">}{</a><a id="5846" href="/Soundness/#5846" class="Bound">N</a><a id="5847" class="Symbol">}{</a><a id="5849" href="/Soundness/#5849" class="Bound">M</a><a id="5850" class="Symbol">}{</a><a id="5852" href="/Soundness/#5852" class="Bound">v</a><a id="5853" class="Symbol">}{</a><a id="5855" href="/Soundness/#5855" class="Bound">w</a><a id="5856" class="Symbol">}</a> <a id="5858" href="/Soundness/#5858" class="Bound">dn</a> <a id="5861" href="/Soundness/#5861" class="Bound">dm</a> <a id="5864" class="Symbol">=</a>
  <a id="5868" href="/Soundness/#4212" class="Function">subst-pres</a> <a id="5879" class="Symbol">(</a><a id="5880" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5891" href="/Soundness/#5849" class="Bound">M</a><a id="5892" class="Symbol">)</a> <a id="5894" href="/Soundness/#5916" class="Function">sub-z-ok</a> <a id="5903" href="/Soundness/#5858" class="Bound">dn</a>
  <a id="5908" class="Keyword">where</a>
  <a id="5916" href="/Soundness/#5916" class="Function">sub-z-ok</a> <a id="5925" class="Symbol">:</a> <a id="5927" href="/Soundness/#5843" class="Bound">γ</a> <a id="5929" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="5932" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5943" href="/Soundness/#5849" class="Bound">M</a> <a id="5945" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="5947" class="Symbol">(</a><a id="5948" href="/Soundness/#5843" class="Bound">γ</a> <a id="5950" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="5953" href="/Soundness/#5852" class="Bound">v</a><a id="5954" class="Symbol">)</a>
  <a id="5958" href="/Soundness/#5916" class="Function">sub-z-ok</a> <a id="5967" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="5969" class="Symbol">=</a> <a id="5971" href="/Soundness/#5861" class="Bound">dm</a>
  <a id="5976" href="/Soundness/#5916" class="Function">sub-z-ok</a> <a id="5985" class="Symbol">(</a><a id="5986" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="5988" href="/Soundness/#5988" class="Bound">x</a><a id="5989" class="Symbol">)</a> <a id="5991" class="Symbol">=</a> <a id="5993" href="/Denotational/#9925" class="InductiveConstructor">var</a></pre>

<p>This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that <code class="highlighter-rouge">subst-zero M</code> maps
variables to terms that produces the same values as those in <code class="highlighter-rouge">γ , v</code>.
Let <code class="highlighter-rouge">y</code> be an arbitrary variable (de Bruijn index).</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then <code class="highlighter-rouge">(subst-zero M) y = M</code> and <code class="highlighter-rouge">nth y (γ , v) = v</code>.
By the premise we conclude that <code class="highlighter-rouge">γ ⊢ M ↓ v</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x</code>, then <code class="highlighter-rouge">(subst-zero M) (S x) = x</code> and
<code class="highlighter-rouge">nth (S x) (γ , v) = nth x γ</code>.  So we conclude that
<code class="highlighter-rouge">γ ⊢ x ↓ nth x γ</code> by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
</ul>

<h3 id="reduction-preserves-denotations">Reduction preserves denotations</h3>

<p>With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.</p>

<pre class="Agda"><a id="preserve"></a><a id="6686" href="/Soundness/#6686" class="Function">preserve</a> <a id="6695" class="Symbol">:</a> <a id="6697" class="Symbol">∀</a> <a id="6699" class="Symbol">{</a><a id="6700" href="/Soundness/#6700" class="Bound">Γ</a><a id="6701" class="Symbol">}</a> <a id="6703" class="Symbol">{</a><a id="6704" href="/Soundness/#6704" class="Bound">γ</a> <a id="6706" class="Symbol">:</a> <a id="6708" href="/Denotational/#7331" class="Function">Env</a> <a id="6712" href="/Soundness/#6700" class="Bound">Γ</a><a id="6713" class="Symbol">}</a> <a id="6715" class="Symbol">{</a><a id="6716" href="/Soundness/#6716" class="Bound">M</a> <a id="6718" href="/Soundness/#6718" class="Bound">N</a> <a id="6720" href="/Soundness/#6720" class="Bound">v</a><a id="6721" class="Symbol">}</a>
  <a id="6725" class="Symbol">→</a> <a id="6727" href="/Soundness/#6704" class="Bound">γ</a> <a id="6729" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="6731" href="/Soundness/#6716" class="Bound">M</a> <a id="6733" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="6735" href="/Soundness/#6720" class="Bound">v</a>
  <a id="6739" class="Symbol">→</a> <a id="6741" href="/Soundness/#6716" class="Bound">M</a> <a id="6743" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="6746" href="/Soundness/#6718" class="Bound">N</a>
    <a id="6752" class="Comment">----------</a>
  <a id="6765" class="Symbol">→</a> <a id="6767" href="/Soundness/#6704" class="Bound">γ</a> <a id="6769" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="6771" href="/Soundness/#6718" class="Bound">N</a> <a id="6773" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="6775" href="/Soundness/#6720" class="Bound">v</a>
<a id="6777" href="/Soundness/#6686" class="Function">preserve</a> <a id="6786" class="Symbol">(</a><a id="6787" href="/Denotational/#9925" class="InductiveConstructor">var</a><a id="6790" class="Symbol">)</a> <a id="6792" class="Symbol">()</a>
<a id="6795" href="/Soundness/#6686" class="Function">preserve</a> <a id="6804" class="Symbol">(</a><a id="6805" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="6812" href="/Soundness/#6812" class="Bound">d₁</a> <a id="6815" href="/Soundness/#6815" class="Bound">d₂</a><a id="6817" class="Symbol">)</a> <a id="6819" class="Symbol">(</a><a id="6820" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="6823" href="/Soundness/#6823" class="Bound">r</a><a id="6824" class="Symbol">)</a> <a id="6826" class="Symbol">=</a> <a id="6828" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="6835" class="Symbol">(</a><a id="6836" href="/Soundness/#6686" class="Function">preserve</a> <a id="6845" href="/Soundness/#6812" class="Bound">d₁</a> <a id="6848" href="/Soundness/#6823" class="Bound">r</a><a id="6849" class="Symbol">)</a> <a id="6851" href="/Soundness/#6815" class="Bound">d₂</a> 
<a id="6855" href="/Soundness/#6686" class="Function">preserve</a> <a id="6864" class="Symbol">(</a><a id="6865" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="6872" href="/Soundness/#6872" class="Bound">d₁</a> <a id="6875" href="/Soundness/#6875" class="Bound">d₂</a><a id="6877" class="Symbol">)</a> <a id="6879" class="Symbol">(</a><a id="6880" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="6883" href="/Soundness/#6883" class="Bound">r</a><a id="6884" class="Symbol">)</a> <a id="6886" class="Symbol">=</a> <a id="6888" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="6895" href="/Soundness/#6872" class="Bound">d₁</a> <a id="6898" class="Symbol">(</a><a id="6899" href="/Soundness/#6686" class="Function">preserve</a> <a id="6908" href="/Soundness/#6875" class="Bound">d₂</a> <a id="6911" href="/Soundness/#6883" class="Bound">r</a><a id="6912" class="Symbol">)</a> 
<a id="6915" href="/Soundness/#6686" class="Function">preserve</a> <a id="6924" class="Symbol">(</a><a id="6925" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="6932" href="/Soundness/#6932" class="Bound">d₁</a> <a id="6935" href="/Soundness/#6935" class="Bound">d₂</a><a id="6937" class="Symbol">)</a> <a id="6939" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="6941" class="Symbol">=</a> <a id="6943" href="/Soundness/#5704" class="Function">substitution</a> <a id="6956" class="Symbol">(</a><a id="6957" href="/Compositional/#2952" class="Function">lambda-inversion</a> <a id="6974" href="/Soundness/#6932" class="Bound">d₁</a><a id="6976" class="Symbol">)</a> <a id="6978" href="/Soundness/#6935" class="Bound">d₂</a>
<a id="6981" href="/Soundness/#6686" class="Function">preserve</a> <a id="6990" class="Symbol">(</a><a id="6991" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="6999" href="/Soundness/#6999" class="Bound">d</a><a id="7000" class="Symbol">)</a> <a id="7002" class="Symbol">(</a><a id="7003" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="7005" href="/Soundness/#7005" class="Bound">r</a><a id="7006" class="Symbol">)</a> <a id="7008" class="Symbol">=</a> <a id="7010" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="7018" class="Symbol">(</a><a id="7019" href="/Soundness/#6686" class="Function">preserve</a> <a id="7028" href="/Soundness/#6999" class="Bound">d</a> <a id="7030" href="/Soundness/#7005" class="Bound">r</a><a id="7031" class="Symbol">)</a>
<a id="7033" href="/Soundness/#6686" class="Function">preserve</a> <a id="7042" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="7050" href="/Soundness/#7050" class="Bound">r</a> <a id="7052" class="Symbol">=</a> <a id="7054" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a>
<a id="7062" href="/Soundness/#6686" class="Function">preserve</a> <a id="7071" class="Symbol">(</a><a id="7072" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="7080" href="/Soundness/#7080" class="Bound">d</a> <a id="7082" href="/Soundness/#7082" class="Bound">d₁</a><a id="7084" class="Symbol">)</a> <a id="7086" href="/Soundness/#7086" class="Bound">r</a> <a id="7088" class="Symbol">=</a> <a id="7090" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="7098" class="Symbol">(</a><a id="7099" href="/Soundness/#6686" class="Function">preserve</a> <a id="7108" href="/Soundness/#7080" class="Bound">d</a> <a id="7110" href="/Soundness/#7086" class="Bound">r</a><a id="7111" class="Symbol">)</a> <a id="7113" class="Symbol">(</a><a id="7114" href="/Soundness/#6686" class="Function">preserve</a> <a id="7123" href="/Soundness/#7082" class="Bound">d₁</a> <a id="7126" href="/Soundness/#7086" class="Bound">r</a><a id="7127" class="Symbol">)</a>
<a id="7129" href="/Soundness/#6686" class="Function">preserve</a> <a id="7138" class="Symbol">(</a><a id="7139" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="7143" href="/Soundness/#7143" class="Bound">d</a> <a id="7145" href="/Soundness/#7145" class="Bound">lt</a><a id="7147" class="Symbol">)</a> <a id="7149" href="/Soundness/#7149" class="Bound">r</a> <a id="7151" class="Symbol">=</a> <a id="7153" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="7157" class="Symbol">(</a><a id="7158" href="/Soundness/#6686" class="Function">preserve</a> <a id="7167" href="/Soundness/#7143" class="Bound">d</a> <a id="7169" href="/Soundness/#7149" class="Bound">r</a><a id="7170" class="Symbol">)</a> <a id="7172" href="/Soundness/#7145" class="Bound">lt</a></pre>

<p>We proceed by induction on the semantics of <code class="highlighter-rouge">M</code> with case analysis on
the reduction.</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is a variable, then there is no such reduction.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is an application, then the reduction is either a congruence
(ξ₁ or ξ₂) or β. For each congruence, we use the induction
hypothesis. For β reduction we use the substitution lemma and the
<code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>The rest of the cases are straightforward.</p>
  </li>
</ul>

<h2 id="reduction-reflects-denotations">Reduction reflects denotations</h2>

<p>This section proves that reduction reflects the denotation of a
term. That is, if <code class="highlighter-rouge">N</code> results in <code class="highlighter-rouge">v</code>, and if <code class="highlighter-rouge">M</code> reduces to <code class="highlighter-rouge">N</code>, then
<code class="highlighter-rouge">M</code> also results in <code class="highlighter-rouge">v</code>. While there are some broad similarities
between this proof and the above proof of semantic preservation, we
shall require a few more technical lemmas to obtain this result.</p>

<p>The main challenge is dealing with the substitution in β reduction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ƛ N) · M —→ N [ M ]
</code></pre></div></div>

<p>We have that <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code> and need to show that
<code class="highlighter-rouge">γ ⊢ (ƛ N) · M ↓ v</code>. Now consider the derivation of <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code>.
The term <code class="highlighter-rouge">M</code> may occur 0, 1, or many times inside <code class="highlighter-rouge">N [ M ]</code>. At each of
those occurences, <code class="highlighter-rouge">M</code> may result in a different value. But to build a
derivation for <code class="highlighter-rouge">(ƛ N) · M</code>, we need a single value for <code class="highlighter-rouge">M</code>.  If <code class="highlighter-rouge">M</code>
occured more than 1 time, then we can join all of the different values
using <code class="highlighter-rouge">⊔</code>. If <code class="highlighter-rouge">M</code> occured 0 times, then we do not need any information
about <code class="highlighter-rouge">M</code> and can therefore use <code class="highlighter-rouge">⊥</code> for the value of <code class="highlighter-rouge">M</code>.</p>

<h3 id="renaming-reflects-meaning">Renaming reflects meaning</h3>

<p>Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if <code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code>, where <code class="highlighter-rouge">(δ ∘ ρ) </code>⊑ γ`.</p>

<p>First, we need a variant of a lemma given earlier.</p>
<pre class="Agda"><a id="nth-ext"></a><a id="8878" href="/Soundness/#8878" class="Function">nth-ext</a> <a id="8886" class="Symbol">:</a> <a id="8888" class="Symbol">∀</a> <a id="8890" class="Symbol">{</a><a id="8891" href="/Soundness/#8891" class="Bound">Γ</a> <a id="8893" href="/Soundness/#8893" class="Bound">Δ</a> <a id="8895" href="/Soundness/#8895" class="Bound">v</a><a id="8896" class="Symbol">}</a> <a id="8898" class="Symbol">{</a><a id="8899" href="/Soundness/#8899" class="Bound">γ</a> <a id="8901" class="Symbol">:</a> <a id="8903" href="/Denotational/#7331" class="Function">Env</a> <a id="8907" href="/Soundness/#8891" class="Bound">Γ</a><a id="8908" class="Symbol">}</a> <a id="8910" class="Symbol">{</a><a id="8911" href="/Soundness/#8911" class="Bound">δ</a> <a id="8913" class="Symbol">:</a> <a id="8915" href="/Denotational/#7331" class="Function">Env</a> <a id="8919" href="/Soundness/#8893" class="Bound">Δ</a><a id="8920" class="Symbol">}</a>
  <a id="8924" class="Symbol">→</a> <a id="8926" class="Symbol">(</a><a id="8927" href="/Soundness/#8927" class="Bound">ρ</a> <a id="8929" class="Symbol">:</a> <a id="8931" href="/Denotational/#23286" class="Function">Rename</a> <a id="8938" href="/Soundness/#8891" class="Bound">Γ</a> <a id="8940" href="/Soundness/#8893" class="Bound">Δ</a><a id="8941" class="Symbol">)</a>
  <a id="8945" class="Symbol">→</a> <a id="8947" class="Symbol">(</a><a id="8948" href="/Soundness/#8911" class="Bound">δ</a> <a id="8950" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="8952" href="/Soundness/#8927" class="Bound">ρ</a><a id="8953" class="Symbol">)</a> <a id="8955" href="/Denotational/#8357" class="Function Operator">`⊑</a> <a id="8958" href="/Soundness/#8899" class="Bound">γ</a>
    <a id="8964" class="Comment">------------------------------</a>
  <a id="8997" class="Symbol">→</a> <a id="8999" class="Symbol">((</a><a id="9001" href="/Soundness/#8911" class="Bound">δ</a> <a id="9003" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="9006" href="/Soundness/#8895" class="Bound">v</a><a id="9007" class="Symbol">)</a> <a id="9009" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="9011" href="/Untyped/#5845" class="Function">ext</a> <a id="9015" href="/Soundness/#8927" class="Bound">ρ</a><a id="9016" class="Symbol">)</a> <a id="9018" href="/Denotational/#8357" class="Function Operator">`⊑</a> <a id="9021" class="Symbol">(</a><a id="9022" href="/Soundness/#8899" class="Bound">γ</a> <a id="9024" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="9027" href="/Soundness/#8895" class="Bound">v</a><a id="9028" class="Symbol">)</a>
<a id="9030" href="/Soundness/#8878" class="Function">nth-ext</a> <a id="9038" href="/Soundness/#9038" class="Bound">ρ</a> <a id="9040" href="/Soundness/#9040" class="Bound">lt</a> <a id="9043" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="9045" class="Symbol">=</a> <a id="9047" href="/Denotational/#5638" class="Function">Refl⊑</a>
<a id="9053" href="/Soundness/#8878" class="Function">nth-ext</a> <a id="9061" href="/Soundness/#9061" class="Bound">ρ</a> <a id="9063" href="/Soundness/#9063" class="Bound">lt</a> <a id="9066" class="Symbol">(</a><a id="9067" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="9069" href="/Soundness/#9069" class="Bound">x</a><a id="9070" class="Symbol">)</a> <a id="9072" class="Symbol">=</a> <a id="9074" href="/Soundness/#9063" class="Bound">lt</a> <a id="9077" href="/Soundness/#9069" class="Bound">x</a></pre>

<p>The proof is then as follows.</p>
<pre class="Agda"><a id="rename-reflect"></a><a id="9134" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9149" class="Symbol">:</a> <a id="9151" class="Symbol">∀</a> <a id="9153" class="Symbol">{</a><a id="9154" href="/Soundness/#9154" class="Bound">Γ</a> <a id="9156" href="/Soundness/#9156" class="Bound">Δ</a> <a id="9158" href="/Soundness/#9158" class="Bound">v</a><a id="9159" class="Symbol">}</a> <a id="9161" class="Symbol">{</a><a id="9162" href="/Soundness/#9162" class="Bound">γ</a> <a id="9164" class="Symbol">:</a> <a id="9166" href="/Denotational/#7331" class="Function">Env</a> <a id="9170" href="/Soundness/#9154" class="Bound">Γ</a><a id="9171" class="Symbol">}</a> <a id="9173" class="Symbol">{</a><a id="9174" href="/Soundness/#9174" class="Bound">δ</a> <a id="9176" class="Symbol">:</a> <a id="9178" href="/Denotational/#7331" class="Function">Env</a> <a id="9182" href="/Soundness/#9156" class="Bound">Δ</a><a id="9183" class="Symbol">}</a> <a id="9185" class="Symbol">{</a> <a id="9187" href="/Soundness/#9187" class="Bound">M</a> <a id="9189" class="Symbol">:</a> <a id="9191" href="/Soundness/#9154" class="Bound">Γ</a> <a id="9193" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="9195" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="9196" class="Symbol">}</a>
  <a id="9200" class="Symbol">→</a> <a id="9202" class="Symbol">{</a><a id="9203" href="/Soundness/#9203" class="Bound">ρ</a> <a id="9205" class="Symbol">:</a> <a id="9207" href="/Denotational/#23286" class="Function">Rename</a> <a id="9214" href="/Soundness/#9154" class="Bound">Γ</a> <a id="9216" href="/Soundness/#9156" class="Bound">Δ</a><a id="9217" class="Symbol">}</a>
  <a id="9221" class="Symbol">→</a> <a id="9223" class="Symbol">(</a><a id="9224" href="/Soundness/#9174" class="Bound">δ</a> <a id="9226" href="https://agda.github.io/agda-stdlib/Function.html#769" class="Function Operator">∘</a> <a id="9228" href="/Soundness/#9203" class="Bound">ρ</a><a id="9229" class="Symbol">)</a> <a id="9231" href="/Denotational/#8357" class="Function Operator">`⊑</a> <a id="9234" href="/Soundness/#9162" class="Bound">γ</a>
  <a id="9238" class="Symbol">→</a> <a id="9240" href="/Soundness/#9174" class="Bound">δ</a> <a id="9242" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="9244" href="/Untyped/#6171" class="Function">rename</a> <a id="9251" href="/Soundness/#9203" class="Bound">ρ</a> <a id="9253" href="/Soundness/#9187" class="Bound">M</a> <a id="9255" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="9257" href="/Soundness/#9158" class="Bound">v</a>
    <a id="9263" class="Comment">------------------------------------</a>
  <a id="9302" class="Symbol">→</a> <a id="9304" href="/Soundness/#9162" class="Bound">γ</a> <a id="9306" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="9308" href="/Soundness/#9187" class="Bound">M</a> <a id="9310" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="9312" href="/Soundness/#9158" class="Bound">v</a>
<a id="9314" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9329" class="Symbol">{</a><a id="9330" class="Argument">M</a> <a id="9332" class="Symbol">=</a> <a id="9334" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="9336" href="/Soundness/#9336" class="Bound">x</a><a id="9337" class="Symbol">}</a> <a id="9339" href="/Soundness/#9339" class="Bound">all-n</a> <a id="9345" href="/Soundness/#9345" class="Bound">d</a> <a id="9347" class="Keyword">with</a> <a id="9352" href="/Compositional/#9007" class="Function">var-inv</a> <a id="9360" href="/Soundness/#9345" class="Bound">d</a>
<a id="9362" class="Symbol">...</a> <a id="9366" class="Symbol">|</a> <a id="9368" href="/Soundness/#9368" class="Bound">lt</a> <a id="9371" class="Symbol">=</a>  <a id="9374" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="9378" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="9382" class="Symbol">(</a><a id="9383" href="/Denotational/#4765" class="InductiveConstructor">Trans⊑</a> <a id="9390" href="/Soundness/#9368" class="Bound">lt</a> <a id="9393" class="Symbol">(</a><a id="9394" class="Bound">all-n</a> <a id="9400" class="Bound">x</a><a id="9401" class="Symbol">))</a>
<a id="9404" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9419" class="Symbol">{</a><a id="9420" class="Argument">M</a> <a id="9422" class="Symbol">=</a> <a id="9424" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9426" href="/Soundness/#9426" class="Bound">N</a><a id="9427" class="Symbol">}{</a><a id="9429" class="Argument">ρ</a> <a id="9431" class="Symbol">=</a> <a id="9433" href="/Soundness/#9433" class="Bound">ρ</a><a id="9434" class="Symbol">}</a> <a id="9436" href="/Soundness/#9436" class="Bound">all-n</a> <a id="9442" class="Symbol">(</a><a id="9443" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="9451" href="/Soundness/#9451" class="Bound">d</a><a id="9452" class="Symbol">)</a> <a id="9454" class="Symbol">=</a>
   <a id="9459" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="9467" class="Symbol">(</a><a id="9468" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9483" class="Symbol">(</a><a id="9484" href="/Soundness/#8878" class="Function">nth-ext</a> <a id="9492" href="/Soundness/#9433" class="Bound">ρ</a> <a id="9494" href="/Soundness/#9436" class="Bound">all-n</a><a id="9499" class="Symbol">)</a> <a id="9501" href="/Soundness/#9451" class="Bound">d</a><a id="9502" class="Symbol">)</a>
<a id="9504" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9519" class="Symbol">{</a><a id="9520" class="Argument">M</a> <a id="9522" class="Symbol">=</a> <a id="9524" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9526" href="/Soundness/#9526" class="Bound">N</a><a id="9527" class="Symbol">}</a> <a id="9529" href="/Soundness/#9529" class="Bound">all-n</a> <a id="9535" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="9543" class="Symbol">=</a> <a id="9545" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a>
<a id="9553" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9568" class="Symbol">{</a><a id="9569" class="Argument">M</a> <a id="9571" class="Symbol">=</a> <a id="9573" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9575" href="/Soundness/#9575" class="Bound">N</a><a id="9576" class="Symbol">}</a> <a id="9578" href="/Soundness/#9578" class="Bound">all-n</a> <a id="9584" class="Symbol">(</a><a id="9585" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="9593" href="/Soundness/#9593" class="Bound">d₁</a> <a id="9596" href="/Soundness/#9596" class="Bound">d₂</a><a id="9598" class="Symbol">)</a> <a id="9600" class="Symbol">=</a>
   <a id="9605" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="9613" class="Symbol">(</a><a id="9614" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9629" href="/Soundness/#9578" class="Bound">all-n</a> <a id="9635" href="/Soundness/#9593" class="Bound">d₁</a><a id="9637" class="Symbol">)</a> <a id="9639" class="Symbol">(</a><a id="9640" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9655" href="/Soundness/#9578" class="Bound">all-n</a> <a id="9661" href="/Soundness/#9596" class="Bound">d₂</a><a id="9663" class="Symbol">)</a>
<a id="9665" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9680" class="Symbol">{</a><a id="9681" class="Argument">M</a> <a id="9683" class="Symbol">=</a> <a id="9685" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9687" href="/Soundness/#9687" class="Bound">N</a><a id="9688" class="Symbol">}</a> <a id="9690" href="/Soundness/#9690" class="Bound">all-n</a> <a id="9696" class="Symbol">(</a><a id="9697" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="9701" href="/Soundness/#9701" class="Bound">d₁</a> <a id="9704" href="/Soundness/#9704" class="Bound">lt</a><a id="9706" class="Symbol">)</a> <a id="9708" class="Symbol">=</a>
   <a id="9713" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="9717" class="Symbol">(</a><a id="9718" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9733" href="/Soundness/#9690" class="Bound">all-n</a> <a id="9739" href="/Soundness/#9701" class="Bound">d₁</a><a id="9741" class="Symbol">)</a> <a id="9743" href="/Soundness/#9704" class="Bound">lt</a>
<a id="9746" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9761" class="Symbol">{</a><a id="9762" class="Argument">M</a> <a id="9764" class="Symbol">=</a> <a id="9766" href="/Soundness/#9766" class="Bound">L</a> <a id="9768" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9770" href="/Soundness/#9770" class="Bound">M</a><a id="9771" class="Symbol">}</a> <a id="9773" href="/Soundness/#9773" class="Bound">all-n</a> <a id="9779" class="Symbol">(</a><a id="9780" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="9787" href="/Soundness/#9787" class="Bound">d₁</a> <a id="9790" href="/Soundness/#9790" class="Bound">d₂</a><a id="9792" class="Symbol">)</a> <a id="9794" class="Symbol">=</a>
   <a id="9799" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="9806" class="Symbol">(</a><a id="9807" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9822" href="/Soundness/#9773" class="Bound">all-n</a> <a id="9828" href="/Soundness/#9787" class="Bound">d₁</a><a id="9830" class="Symbol">)</a> <a id="9832" class="Symbol">(</a><a id="9833" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9848" href="/Soundness/#9773" class="Bound">all-n</a> <a id="9854" href="/Soundness/#9790" class="Bound">d₂</a><a id="9856" class="Symbol">)</a> 
<a id="9859" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9874" class="Symbol">{</a><a id="9875" class="Argument">M</a> <a id="9877" class="Symbol">=</a> <a id="9879" href="/Soundness/#9879" class="Bound">L</a> <a id="9881" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9883" href="/Soundness/#9883" class="Bound">M</a><a id="9884" class="Symbol">}</a> <a id="9886" href="/Soundness/#9886" class="Bound">all-n</a> <a id="9892" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="9900" class="Symbol">=</a> <a id="9902" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a>
<a id="9910" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9925" class="Symbol">{</a><a id="9926" class="Argument">M</a> <a id="9928" class="Symbol">=</a> <a id="9930" href="/Soundness/#9930" class="Bound">L</a> <a id="9932" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9934" href="/Soundness/#9934" class="Bound">M</a><a id="9935" class="Symbol">}</a> <a id="9937" href="/Soundness/#9937" class="Bound">all-n</a> <a id="9943" class="Symbol">(</a><a id="9944" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="9952" href="/Soundness/#9952" class="Bound">d₁</a> <a id="9955" href="/Soundness/#9955" class="Bound">d₂</a><a id="9957" class="Symbol">)</a> <a id="9959" class="Symbol">=</a>
   <a id="9964" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="9972" class="Symbol">(</a><a id="9973" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="9988" href="/Soundness/#9937" class="Bound">all-n</a> <a id="9994" href="/Soundness/#9952" class="Bound">d₁</a><a id="9996" class="Symbol">)</a> <a id="9998" class="Symbol">(</a><a id="9999" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="10014" href="/Soundness/#9937" class="Bound">all-n</a> <a id="10020" href="/Soundness/#9955" class="Bound">d₂</a><a id="10022" class="Symbol">)</a>
<a id="10024" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="10039" class="Symbol">{</a><a id="10040" class="Argument">M</a> <a id="10042" class="Symbol">=</a> <a id="10044" href="/Soundness/#10044" class="Bound">L</a> <a id="10046" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="10048" href="/Soundness/#10048" class="Bound">M</a><a id="10049" class="Symbol">}</a> <a id="10051" href="/Soundness/#10051" class="Bound">all-n</a> <a id="10057" class="Symbol">(</a><a id="10058" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="10062" href="/Soundness/#10062" class="Bound">d₁</a> <a id="10065" href="/Soundness/#10065" class="Bound">lt</a><a id="10067" class="Symbol">)</a> <a id="10069" class="Symbol">=</a>
   <a id="10074" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="10078" class="Symbol">(</a><a id="10079" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="10094" href="/Soundness/#10051" class="Bound">all-n</a> <a id="10100" href="/Soundness/#10062" class="Bound">d₁</a><a id="10102" class="Symbol">)</a> <a id="10104" href="/Soundness/#10065" class="Bound">lt</a></pre>

<p>We cannot prove this lemma by induction on the derivation of
<code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, so instead we proceed by induction on <code class="highlighter-rouge">M</code>.</p>

<ul>
  <li>
    <p>If it is a variable, we apply the inversion lemma to obtain
that <code class="highlighter-rouge">v ⊑ nth (ρ x) δ</code>. Instantiating the premise to <code class="highlighter-rouge">x</code> we have
<code class="highlighter-rouge">nth (ρ x) δ = nth x γ</code>, so we conclude by the <code class="highlighter-rouge">var</code> rule.</p>
  </li>
  <li>
    <p>If it is a lambda abstraction <code class="highlighter-rouge">ƛ N</code>, we have
rename <code class="highlighter-rouge">ρ (ƛ N) = ƛ (rename (ext ρ) N)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ ƛ (rename (ext ρ) N) ↓ v</code>.</p>

    <ul>
      <li>
        <p>Rule <code class="highlighter-rouge">↦-intro</code>: To satisfy the premise of the induction
hypothesis, we prove that the renaming can be extended to be a
mapping from <code class="highlighter-rouge">γ , v₁ to δ , v₁</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊥-intro</code>: We simply apply <code class="highlighter-rouge">⊥-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊔-intro</code>: We apply the induction hypotheses and <code class="highlighter-rouge">⊔-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">sub</code>: We apply the induction hypothesis and <code class="highlighter-rouge">sub</code>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>If it is an application <code class="highlighter-rouge">L · M</code>, we have
<code class="highlighter-rouge">rename ρ (L · M) = (rename ρ L) · (rename ρ M)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ (rename ρ L) · (rename ρ M) ↓ v</code>
and all the cases are straightforward.</p>
  </li>
</ul>

<p>In the upcoming uses of <code class="highlighter-rouge">rename-reflect</code>, the renaming will always be
the increment function. So we prove a corollary for that special case.</p>

<pre class="Agda"><a id="rename-inc-reflect"></a><a id="11285" href="/Soundness/#11285" class="Function">rename-inc-reflect</a> <a id="11304" class="Symbol">:</a> <a id="11306" class="Symbol">∀</a> <a id="11308" class="Symbol">{</a><a id="11309" href="/Soundness/#11309" class="Bound">Γ</a> <a id="11311" href="/Soundness/#11311" class="Bound">v&#39;</a> <a id="11314" href="/Soundness/#11314" class="Bound">v</a><a id="11315" class="Symbol">}</a> <a id="11317" class="Symbol">{</a><a id="11318" href="/Soundness/#11318" class="Bound">γ</a> <a id="11320" class="Symbol">:</a> <a id="11322" href="/Denotational/#7331" class="Function">Env</a> <a id="11326" href="/Soundness/#11309" class="Bound">Γ</a><a id="11327" class="Symbol">}</a> <a id="11329" class="Symbol">{</a> <a id="11331" href="/Soundness/#11331" class="Bound">M</a> <a id="11333" class="Symbol">:</a> <a id="11335" href="/Soundness/#11309" class="Bound">Γ</a> <a id="11337" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="11339" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11340" class="Symbol">}</a>
  <a id="11344" class="Symbol">→</a> <a id="11346" class="Symbol">(</a><a id="11347" href="/Soundness/#11318" class="Bound">γ</a> <a id="11349" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="11352" href="/Soundness/#11311" class="Bound">v&#39;</a><a id="11354" class="Symbol">)</a> <a id="11356" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="11358" href="/Untyped/#6171" class="Function">rename</a> <a id="11365" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="11368" href="/Soundness/#11331" class="Bound">M</a> <a id="11370" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="11372" href="/Soundness/#11314" class="Bound">v</a>
    <a id="11378" class="Comment">----------------------------</a>
  <a id="11409" class="Symbol">→</a> <a id="11411" href="/Soundness/#11318" class="Bound">γ</a> <a id="11413" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="11415" href="/Soundness/#11331" class="Bound">M</a> <a id="11417" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="11419" href="/Soundness/#11314" class="Bound">v</a>
<a id="11421" href="/Soundness/#11285" class="Function">rename-inc-reflect</a> <a id="11440" href="/Soundness/#11440" class="Bound">d</a> <a id="11442" class="Symbol">=</a> <a id="11444" href="/Soundness/#9134" class="Function">rename-reflect</a> <a id="11459" href="/Denotational/#8875" class="Function">`Refl⊑</a> <a id="11466" href="/Soundness/#11440" class="Bound">d</a></pre>

<h3 id="substitution-reflects-denotations-the-variable-case">Substitution reflects denotations, the variable case</h3>

<p>We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ (subst σ M) ↓ v</code>, then
<code class="highlighter-rouge">γ ⊢ σ k ↓ nth k δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code> and some <code class="highlighter-rouge">δ</code>.
We shall start with the case in which <code class="highlighter-rouge">M</code> is a variable <code class="highlighter-rouge">x</code>.
So instead the premise is <code class="highlighter-rouge">γ ⊢ σ x ↓ v</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ x ↓ v</code> for some <code class="highlighter-rouge">δ</code>. The <code class="highlighter-rouge">δ</code> that we choose shall be the
environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other variable to <code class="highlighter-rouge">⊥</code>.</p>

<p>The nth element of the `⊥ environment is always ⊥.
[PLW: Probably can omit]</p>
<pre class="Agda"><a id="nth-`⊥"></a><a id="12075" href="/Soundness/#12075" class="Function">nth-`⊥</a> <a id="12082" class="Symbol">:</a> <a id="12084" class="Symbol">∀{</a><a id="12086" href="/Soundness/#12086" class="Bound">Γ</a><a id="12087" class="Symbol">}</a> <a id="12089" class="Symbol">{</a><a id="12090" href="/Soundness/#12090" class="Bound">x</a> <a id="12092" class="Symbol">:</a> <a id="12094" href="/Soundness/#12086" class="Bound">Γ</a> <a id="12096" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12098" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12099" class="Symbol">}</a> <a id="12101" class="Symbol">→</a> <a id="12103" href="/Denotational/#8576" class="Function">`⊥</a> <a id="12106" href="/Soundness/#12090" class="Bound">x</a> <a id="12108" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12110" href="/Denotational/#4117" class="InductiveConstructor">⊥</a>
<a id="12112" href="/Soundness/#12075" class="Function">nth-`⊥</a> <a id="12119" class="Symbol">{</a><a id="12120" class="Argument">x</a> <a id="12122" class="Symbol">=</a> <a id="12124" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="12125" class="Symbol">}</a> <a id="12127" class="Symbol">=</a> <a id="12129" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12134" href="/Soundness/#12075" class="Function">nth-`⊥</a> <a id="12141" class="Symbol">{</a><a id="12142" href="/Soundness/#12142" class="Bound">Γ</a> <a id="12144" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="12146" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12147" class="Symbol">}</a> <a id="12149" class="Symbol">{</a><a id="12150" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12152" href="/Soundness/#12152" class="Bound">x</a><a id="12153" class="Symbol">}</a> <a id="12155" class="Symbol">=</a> <a id="12157" href="/Soundness/#12075" class="Function">nth-`⊥</a> <a id="12164" class="Symbol">{</a><a id="12165" href="/Soundness/#12142" class="Bound">Γ</a><a id="12166" class="Symbol">}</a> <a id="12168" class="Symbol">{</a><a id="12169" href="/Soundness/#12152" class="Bound">x</a><a id="12170" class="Symbol">}</a></pre>

<p>Next we define the environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other
variable to <code class="highlighter-rouge">⊥</code>, that is <code class="highlighter-rouge">const-env x v</code>.</p>

<pre class="Agda"><a id="12308" class="Comment">{-
inv-S : ∀ {Γ A B} {x y : Γ ∋ A}
  → _≡_ {_} {Γ , B ∋ A} (S x) (S y)
  → S x ≡ S y
    -------------------------------
  → x ≡ y
inv-S refl = refl
-}</a>

<a id="_var≟_"></a><a id="12461" href="/Soundness/#12461" class="Function Operator">_var≟_</a> <a id="12468" class="Symbol">:</a> <a id="12470" class="Symbol">∀</a> <a id="12472" class="Symbol">{</a><a id="12473" href="/Soundness/#12473" class="Bound">Γ</a><a id="12474" class="Symbol">}</a> <a id="12476" class="Symbol">→</a> <a id="12478" class="Symbol">(</a><a id="12479" href="/Soundness/#12479" class="Bound">x</a> <a id="12481" href="/Soundness/#12481" class="Bound">y</a> <a id="12483" class="Symbol">:</a> <a id="12485" href="/Soundness/#12473" class="Bound">Γ</a> <a id="12487" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12489" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12490" class="Symbol">)</a> <a id="12492" class="Symbol">→</a> <a id="12494" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#534" class="Datatype">Dec</a> <a id="12498" class="Symbol">(</a><a id="12499" href="/Soundness/#12479" class="Bound">x</a> <a id="12501" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12503" href="/Soundness/#12481" class="Bound">y</a><a id="12504" class="Symbol">)</a>
<a id="12506" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12508" href="/Soundness/#12461" class="Function Operator">var≟</a> <a id="12513" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12516" class="Symbol">=</a>  <a id="12519" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12523" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12528" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12530" href="/Soundness/#12461" class="Function Operator">var≟</a> <a id="12535" class="Symbol">(</a><a id="12536" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12538" class="Symbol">_)</a>  <a id="12542" class="Symbol">=</a>  <a id="12545" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12548" class="Symbol">λ()</a>
<a id="12552" class="Symbol">(</a><a id="12553" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12555" class="Symbol">_)</a> <a id="12558" href="/Soundness/#12461" class="Function Operator">var≟</a> <a id="12563" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12566" class="Symbol">=</a>  <a id="12569" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12572" class="Symbol">λ()</a>
<a id="12576" class="Symbol">(</a><a id="12577" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12579" href="/Soundness/#12579" class="Bound">x</a><a id="12580" class="Symbol">)</a> <a id="12582" href="/Soundness/#12461" class="Function Operator">var≟</a> <a id="12587" class="Symbol">(</a><a id="12588" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12590" href="/Soundness/#12590" class="Bound">y</a><a id="12591" class="Symbol">)</a> <a id="12593" class="Keyword">with</a>  <a id="12599" href="/Soundness/#12579" class="Bound">x</a> <a id="12601" href="/Soundness/#12461" class="Function Operator">var≟</a> <a id="12606" href="/Soundness/#12590" class="Bound">y</a>
<a id="12608" class="Symbol">...</a>                 <a id="12628" class="Symbol">|</a>  <a id="12631" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12635" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12640" class="Symbol">=</a>  <a id="12643" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12647" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12652" class="Symbol">...</a>                 <a id="12672" class="Symbol">|</a>  <a id="12675" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12678" href="/Soundness/#12678" class="Bound">neq</a>   <a id="12684" class="Symbol">=</a>  <a id="12687" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12690" class="Symbol">λ{</a><a id="12692" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12697" class="Symbol">→</a> <a id="12699" href="/Soundness/#12678" class="Bound">neq</a> <a id="12703" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="12707" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12710" href="/Soundness/#12710" class="Function">var≟-refl</a> <a id="12720" class="Symbol">:</a> <a id="12722" class="Symbol">∀</a> <a id="12724" class="Symbol">{</a><a id="12725" href="/Soundness/#12725" class="Bound">Γ</a><a id="12726" class="Symbol">}</a> <a id="12728" class="Symbol">(</a><a id="12729" href="/Soundness/#12729" class="Bound">x</a> <a id="12731" class="Symbol">:</a> <a id="12733" href="/Soundness/#12725" class="Bound">Γ</a> <a id="12735" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12737" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12738" class="Symbol">)</a> <a id="12740" class="Symbol">→</a> <a id="12742" class="Symbol">(</a><a id="12743" href="/Soundness/#12729" class="Bound">x</a> <a id="12745" href="/Soundness/#12461" class="Function Operator">var≟</a> <a id="12750" href="/Soundness/#12729" class="Bound">x</a><a id="12751" class="Symbol">)</a> <a id="12753" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12755" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12759" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12764" href="/Soundness/#12710" class="Function">var≟-refl</a> <a id="12774" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12776" class="Symbol">=</a> <a id="12778" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12783" href="/Soundness/#12710" class="Function">var≟-refl</a> <a id="12793" class="Symbol">(</a><a id="12794" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12796" href="/Soundness/#12796" class="Bound">x</a><a id="12797" class="Symbol">)</a> <a id="12799" class="Keyword">rewrite</a> <a id="12807" href="/Soundness/#12710" class="Function">var≟-refl</a> <a id="12817" href="/Soundness/#12796" class="Bound">x</a> <a id="12819" class="Symbol">=</a> <a id="12821" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>

<a id="const-env"></a><a id="12827" href="/Soundness/#12827" class="Function">const-env</a> <a id="12837" class="Symbol">:</a> <a id="12839" class="Symbol">∀{</a><a id="12841" href="/Soundness/#12841" class="Bound">Γ</a><a id="12842" class="Symbol">}</a> <a id="12844" class="Symbol">→</a> <a id="12846" class="Symbol">(</a><a id="12847" href="/Soundness/#12847" class="Bound">x</a> <a id="12849" class="Symbol">:</a> <a id="12851" href="/Soundness/#12841" class="Bound">Γ</a> <a id="12853" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12855" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12856" class="Symbol">)</a> <a id="12858" class="Symbol">→</a> <a id="12860" href="/Denotational/#4097" class="Datatype">Value</a> <a id="12866" class="Symbol">→</a> <a id="12868" href="/Denotational/#7331" class="Function">Env</a> <a id="12872" href="/Soundness/#12841" class="Bound">Γ</a>
<a id="12874" href="/Soundness/#12827" class="Function">const-env</a> <a id="12884" href="/Soundness/#12884" class="Bound">x</a> <a id="12886" href="/Soundness/#12886" class="Bound">v</a> <a id="12888" href="/Soundness/#12888" class="Bound">y</a> <a id="12890" class="Keyword">with</a> <a id="12895" href="/Soundness/#12884" class="Bound">x</a> <a id="12897" href="/Soundness/#12461" class="Function Operator">var≟</a> <a id="12902" href="/Soundness/#12888" class="Bound">y</a>
<a id="12904" class="Symbol">...</a>             <a id="12920" class="Symbol">|</a> <a id="12922" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12926" class="Symbol">_</a>       <a id="12934" class="Symbol">=</a> <a id="12936" class="Bound">v</a>
<a id="12938" class="Symbol">...</a>             <a id="12954" class="Symbol">|</a> <a id="12956" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12959" class="Symbol">_</a>        <a id="12968" class="Symbol">=</a> <a id="12970" href="/Denotational/#4117" class="InductiveConstructor">⊥</a></pre>

<p>Of course, the nth element of <code class="highlighter-rouge">const-env n v</code> is the value <code class="highlighter-rouge">v</code>.</p>

<pre class="Agda"><a id="nth-const-env"></a><a id="13062" href="/Soundness/#13062" class="Function">nth-const-env</a> <a id="13076" class="Symbol">:</a> <a id="13078" class="Symbol">∀{</a><a id="13080" href="/Soundness/#13080" class="Bound">Γ</a><a id="13081" class="Symbol">}</a> <a id="13083" class="Symbol">{</a><a id="13084" href="/Soundness/#13084" class="Bound">x</a> <a id="13086" class="Symbol">:</a> <a id="13088" href="/Soundness/#13080" class="Bound">Γ</a> <a id="13090" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="13092" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="13093" class="Symbol">}</a> <a id="13095" class="Symbol">{</a><a id="13096" href="/Soundness/#13096" class="Bound">v</a><a id="13097" class="Symbol">}</a> <a id="13099" class="Symbol">→</a> <a id="13101" class="Symbol">(</a><a id="13102" href="/Soundness/#12827" class="Function">const-env</a> <a id="13112" href="/Soundness/#13084" class="Bound">x</a> <a id="13114" href="/Soundness/#13096" class="Bound">v</a><a id="13115" class="Symbol">)</a> <a id="13117" href="/Soundness/#13084" class="Bound">x</a> <a id="13119" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13121" href="/Soundness/#13096" class="Bound">v</a>
<a id="13123" href="/Soundness/#13062" class="Function">nth-const-env</a> <a id="13137" class="Symbol">{</a><a id="13138" class="Argument">x</a> <a id="13140" class="Symbol">=</a> <a id="13142" href="/Soundness/#13142" class="Bound">x</a><a id="13143" class="Symbol">}</a> <a id="13145" class="Keyword">rewrite</a> <a id="13153" href="/Soundness/#12710" class="Function">var≟-refl</a> <a id="13163" href="/Soundness/#13142" class="Bound">x</a> <a id="13165" class="Symbol">=</a> <a id="13167" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>The nth element of <code class="highlighter-rouge">const-env n' v</code> is the value <code class="highlighter-rouge">⊥, so long as </code>n ≢ n’`.</p>

<pre class="Agda"><a id="diff-nth-const-env"></a><a id="13272" href="/Soundness/#13272" class="Function">diff-nth-const-env</a> <a id="13291" class="Symbol">:</a> <a id="13293" class="Symbol">∀{</a><a id="13295" href="/Soundness/#13295" class="Bound">Γ</a><a id="13296" class="Symbol">}</a> <a id="13298" class="Symbol">{</a><a id="13299" href="/Soundness/#13299" class="Bound">x</a> <a id="13301" href="/Soundness/#13301" class="Bound">y</a> <a id="13303" class="Symbol">:</a> <a id="13305" href="/Soundness/#13295" class="Bound">Γ</a> <a id="13307" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="13309" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="13310" class="Symbol">}</a> <a id="13312" class="Symbol">{</a><a id="13313" href="/Soundness/#13313" class="Bound">v</a><a id="13314" class="Symbol">}</a>
  <a id="13318" class="Symbol">→</a> <a id="13320" href="/Soundness/#13299" class="Bound">x</a> <a id="13322" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">≢</a> <a id="13324" href="/Soundness/#13301" class="Bound">y</a>
    <a id="13330" class="Comment">-------------------</a>
  <a id="13352" class="Symbol">→</a> <a id="13354" href="/Soundness/#12827" class="Function">const-env</a> <a id="13364" href="/Soundness/#13299" class="Bound">x</a> <a id="13366" href="/Soundness/#13313" class="Bound">v</a> <a id="13368" href="/Soundness/#13301" class="Bound">y</a> <a id="13370" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13372" href="/Denotational/#4117" class="InductiveConstructor">⊥</a>
<a id="13374" href="/Soundness/#13272" class="Function">diff-nth-const-env</a> <a id="13393" class="Symbol">{</a><a id="13394" href="/Soundness/#13394" class="Bound">Γ</a><a id="13395" class="Symbol">}</a> <a id="13397" class="Symbol">{</a><a id="13398" href="/Soundness/#13398" class="Bound">x</a><a id="13399" class="Symbol">}</a> <a id="13401" class="Symbol">{</a><a id="13402" href="/Soundness/#13402" class="Bound">y</a><a id="13403" class="Symbol">}</a> <a id="13405" href="/Soundness/#13405" class="Bound">neq</a> <a id="13409" class="Keyword">with</a> <a id="13414" href="/Soundness/#13398" class="Bound">x</a> <a id="13416" href="/Soundness/#12461" class="Function Operator">var≟</a> <a id="13421" href="/Soundness/#13402" class="Bound">y</a>
<a id="13423" class="Symbol">...</a>  <a id="13428" class="Symbol">|</a> <a id="13430" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="13434" href="/Soundness/#13434" class="Bound">eq</a>  <a id="13438" class="Symbol">=</a>  <a id="13441" href="https://agda.github.io/agda-stdlib/Data.Empty.html#360" class="Function">⊥-elim</a> <a id="13448" class="Symbol">(</a><a id="13449" class="Bound">neq</a> <a id="13453" href="/Soundness/#13434" class="Bound">eq</a><a id="13455" class="Symbol">)</a>
<a id="13457" class="Symbol">...</a>  <a id="13462" class="Symbol">|</a> <a id="13464" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="13467" class="Symbol">_</a>    <a id="13472" class="Symbol">=</a>  <a id="13475" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>So we choose <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code> and obtain <code class="highlighter-rouge">δ ⊢ x ↓ v</code>
with the <code class="highlighter-rouge">var</code> rule.</p>

<p>It remains to prove that <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code>, given that
we have chosen <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code>.  We shall have two cases to
consider, <code class="highlighter-rouge">x ≡ y</code> or <code class="highlighter-rouge">x ≢ y</code>.</p>

<p>Now to finish the two cases of the proof.</p>

<ul>
  <li>In the case where <code class="highlighter-rouge">x ≡ y</code>, we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ v</code>, but that’s just our premise.</li>
  <li>In the case where <code class="highlighter-rouge">x ≢ y,</code> we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ ⊥</code>, which we do via rule <code class="highlighter-rouge">⊥-intro</code>.</li>
</ul>

<p>Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.</p>

<pre class="Agda"><a id="subst-reflect-var"></a><a id="14147" href="/Soundness/#14147" class="Function">subst-reflect-var</a> <a id="14165" class="Symbol">:</a> <a id="14167" class="Symbol">∀</a> <a id="14169" class="Symbol">{</a><a id="14170" href="/Soundness/#14170" class="Bound">Γ</a> <a id="14172" href="/Soundness/#14172" class="Bound">Δ</a><a id="14173" class="Symbol">}</a> <a id="14175" class="Symbol">{</a><a id="14176" href="/Soundness/#14176" class="Bound">γ</a> <a id="14178" class="Symbol">:</a> <a id="14180" href="/Denotational/#7331" class="Function">Env</a> <a id="14184" href="/Soundness/#14172" class="Bound">Δ</a><a id="14185" class="Symbol">}</a> <a id="14187" class="Symbol">{</a><a id="14188" href="/Soundness/#14188" class="Bound">x</a> <a id="14190" class="Symbol">:</a> <a id="14192" href="/Soundness/#14170" class="Bound">Γ</a> <a id="14194" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="14196" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="14197" class="Symbol">}</a> <a id="14199" class="Symbol">{</a><a id="14200" href="/Soundness/#14200" class="Bound">v</a><a id="14201" class="Symbol">}</a> <a id="14203" class="Symbol">{</a><a id="14204" href="/Soundness/#14204" class="Bound">σ</a> <a id="14206" class="Symbol">:</a> <a id="14208" href="/Soundness/#2673" class="Function">Subst</a> <a id="14214" href="/Soundness/#14170" class="Bound">Γ</a> <a id="14216" href="/Soundness/#14172" class="Bound">Δ</a><a id="14217" class="Symbol">}</a>
  <a id="14221" class="Symbol">→</a> <a id="14223" href="/Soundness/#14176" class="Bound">γ</a> <a id="14225" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="14227" href="/Soundness/#14204" class="Bound">σ</a> <a id="14229" href="/Soundness/#14188" class="Bound">x</a> <a id="14231" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="14233" href="/Soundness/#14200" class="Bound">v</a>
    <a id="14239" class="Comment">-----------------------------------------</a>
  <a id="14283" class="Symbol">→</a> <a id="14285" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="14288" href="/Soundness/#14288" class="Bound">δ</a> <a id="14290" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="14292" href="/Denotational/#7331" class="Function">Env</a> <a id="14296" href="/Soundness/#14170" class="Bound">Γ</a> <a id="14298" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="14300" href="/Soundness/#14176" class="Bound">γ</a> <a id="14302" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="14305" href="/Soundness/#14204" class="Bound">σ</a> <a id="14307" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="14309" href="/Soundness/#14288" class="Bound">δ</a>  <a id="14312" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="14315" href="/Soundness/#14288" class="Bound">δ</a> <a id="14317" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="14319" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="14321" href="/Soundness/#14188" class="Bound">x</a> <a id="14323" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="14325" href="/Soundness/#14200" class="Bound">v</a>
<a id="14327" href="/Soundness/#14147" class="Function">subst-reflect-var</a> <a id="14345" class="Symbol">{</a><a id="14346" href="/Soundness/#14346" class="Bound">Γ</a><a id="14347" class="Symbol">}{</a><a id="14349" href="/Soundness/#14349" class="Bound">Δ</a><a id="14350" class="Symbol">}{</a><a id="14352" href="/Soundness/#14352" class="Bound">γ</a><a id="14353" class="Symbol">}{</a><a id="14355" href="/Soundness/#14355" class="Bound">x</a><a id="14356" class="Symbol">}{</a><a id="14358" href="/Soundness/#14358" class="Bound">v</a><a id="14359" class="Symbol">}{</a><a id="14361" href="/Soundness/#14361" class="Bound">σ</a><a id="14362" class="Symbol">}</a> <a id="14364" href="/Soundness/#14364" class="Bound">xv</a>
  <a id="14369" class="Keyword">rewrite</a> <a id="14377" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14381" class="Symbol">(</a><a id="14382" href="/Soundness/#13062" class="Function">nth-const-env</a> <a id="14396" class="Symbol">{</a><a id="14397" href="/Soundness/#14346" class="Bound">Γ</a><a id="14398" class="Symbol">}{</a><a id="14400" href="/Soundness/#14355" class="Bound">x</a><a id="14401" class="Symbol">}{</a><a id="14403" href="/Soundness/#14358" class="Bound">v</a><a id="14404" class="Symbol">})</a> <a id="14407" class="Symbol">=</a>
    <a id="14413" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14415" href="/Soundness/#12827" class="Function">const-env</a> <a id="14425" href="/Soundness/#14355" class="Bound">x</a> <a id="14427" href="/Soundness/#14358" class="Bound">v</a> <a id="14429" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14431" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14433" href="/Soundness/#14466" class="Function">const-env-ok</a> <a id="14446" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14448" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="14452" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="14454" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
  <a id="14458" class="Keyword">where</a>
  <a id="14466" href="/Soundness/#14466" class="Function">const-env-ok</a> <a id="14479" class="Symbol">:</a> <a id="14481" href="/Soundness/#14352" class="Bound">γ</a> <a id="14483" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="14486" href="/Soundness/#14361" class="Bound">σ</a> <a id="14488" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="14490" href="/Soundness/#12827" class="Function">const-env</a> <a id="14500" href="/Soundness/#14355" class="Bound">x</a> <a id="14502" href="/Soundness/#14358" class="Bound">v</a>
  <a id="14506" href="/Soundness/#14466" class="Function">const-env-ok</a> <a id="14519" href="/Soundness/#14519" class="Bound">y</a> <a id="14521" class="Keyword">with</a> <a id="14526" href="/Soundness/#14355" class="Bound">x</a> <a id="14528" href="/Soundness/#12461" class="Function Operator">var≟</a> <a id="14533" href="/Soundness/#14519" class="Bound">y</a>
  <a id="14537" class="Symbol">...</a> <a id="14541" class="Symbol">|</a> <a id="14543" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="14547" href="/Soundness/#14547" class="Bound">x≡y</a> <a id="14551" class="Keyword">rewrite</a> <a id="14559" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14563" href="/Soundness/#14547" class="Bound">x≡y</a> <a id="14567" class="Symbol">|</a> <a id="14569" href="/Soundness/#13062" class="Function">nth-const-env</a> <a id="14583" class="Symbol">{</a><a id="14584" href="/Soundness/#14346" class="Bound">Γ</a><a id="14585" class="Symbol">}{</a><a id="14587" href="/Soundness/#14355" class="Bound">x</a><a id="14588" class="Symbol">}{</a><a id="14590" href="/Soundness/#14358" class="Bound">v</a><a id="14591" class="Symbol">}</a> <a id="14593" class="Symbol">=</a> <a id="14595" href="/Soundness/#14364" class="Bound">xv</a>
  <a id="14600" class="Symbol">...</a> <a id="14604" class="Symbol">|</a> <a id="14606" href="https://agda.github.io/agda-stdlib/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="14609" href="/Soundness/#14609" class="Bound">x≢y</a> <a id="14613" class="Keyword">rewrite</a> <a id="14621" href="/Soundness/#13272" class="Function">diff-nth-const-env</a> <a id="14640" class="Symbol">{</a><a id="14641" href="/Soundness/#14346" class="Bound">Γ</a><a id="14642" class="Symbol">}{</a><a id="14644" href="/Soundness/#14355" class="Bound">x</a><a id="14645" class="Symbol">}{</a><a id="14647" class="Bound">y</a><a id="14648" class="Symbol">}{</a><a id="14650" href="/Soundness/#14358" class="Bound">v</a><a id="14651" class="Symbol">}</a> <a id="14653" href="/Soundness/#14609" class="Bound">x≢y</a> <a id="14657" class="Symbol">=</a> <a id="14659" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a></pre>

<h3 id="substitutions-and-environment-construction">Substitutions and environment construction</h3>

<p>Every substitution produces terms that can evaluate to <code class="highlighter-rouge">⊥</code>.</p>

<pre class="Agda"><a id="subst-⊥"></a><a id="14802" href="/Soundness/#14802" class="Function">subst-⊥</a> <a id="14810" class="Symbol">:</a> <a id="14812" class="Symbol">∀{</a><a id="14814" href="/Soundness/#14814" class="Bound">Γ</a> <a id="14816" href="/Soundness/#14816" class="Bound">Δ</a><a id="14817" class="Symbol">}{</a><a id="14819" href="/Soundness/#14819" class="Bound">γ</a> <a id="14821" class="Symbol">:</a> <a id="14823" href="/Denotational/#7331" class="Function">Env</a> <a id="14827" href="/Soundness/#14816" class="Bound">Δ</a><a id="14828" class="Symbol">}{</a><a id="14830" href="/Soundness/#14830" class="Bound">σ</a> <a id="14832" class="Symbol">:</a> <a id="14834" href="/Soundness/#2673" class="Function">Subst</a> <a id="14840" href="/Soundness/#14814" class="Bound">Γ</a> <a id="14842" href="/Soundness/#14816" class="Bound">Δ</a><a id="14843" class="Symbol">}</a>
    <a id="14849" class="Comment">-----------------</a>
  <a id="14869" class="Symbol">→</a> <a id="14871" href="/Soundness/#14819" class="Bound">γ</a> <a id="14873" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="14876" href="/Soundness/#14830" class="Bound">σ</a> <a id="14878" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="14880" href="/Denotational/#8576" class="Function">`⊥</a>
<a id="14883" href="/Soundness/#14802" class="Function">subst-⊥</a> <a id="14891" href="/Soundness/#14891" class="Bound">x</a> <a id="14893" class="Symbol">=</a> <a id="14895" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a></pre>

<p>If a substitution produces terms that evaluate to the values in
both <code class="highlighter-rouge">γ₁</code> and <code class="highlighter-rouge">γ₂</code>, then those terms also evaluate to the values in 
<code class="highlighter-rouge">γ₁ ⊔ γ₂</code>.</p>

<pre class="Agda"><a id="subst-⊔"></a><a id="15073" href="/Soundness/#15073" class="Function">subst-⊔</a> <a id="15081" class="Symbol">:</a> <a id="15083" class="Symbol">∀{</a><a id="15085" href="/Soundness/#15085" class="Bound">Γ</a> <a id="15087" href="/Soundness/#15087" class="Bound">Δ</a><a id="15088" class="Symbol">}{</a><a id="15090" href="/Soundness/#15090" class="Bound">γ</a> <a id="15092" class="Symbol">:</a> <a id="15094" href="/Denotational/#7331" class="Function">Env</a> <a id="15098" href="/Soundness/#15087" class="Bound">Δ</a><a id="15099" class="Symbol">}{</a><a id="15101" href="/Soundness/#15101" class="Bound">γ₁</a> <a id="15104" href="/Soundness/#15104" class="Bound">γ₂</a> <a id="15107" class="Symbol">:</a> <a id="15109" href="/Denotational/#7331" class="Function">Env</a> <a id="15113" href="/Soundness/#15085" class="Bound">Γ</a><a id="15114" class="Symbol">}{</a><a id="15116" href="/Soundness/#15116" class="Bound">σ</a> <a id="15118" class="Symbol">:</a> <a id="15120" href="/Soundness/#2673" class="Function">Subst</a> <a id="15126" href="/Soundness/#15085" class="Bound">Γ</a> <a id="15128" href="/Soundness/#15087" class="Bound">Δ</a><a id="15129" class="Symbol">}</a>
           <a id="15142" class="Symbol">→</a> <a id="15144" href="/Soundness/#15090" class="Bound">γ</a> <a id="15146" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="15149" href="/Soundness/#15116" class="Bound">σ</a> <a id="15151" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="15153" href="/Soundness/#15101" class="Bound">γ₁</a>
           <a id="15167" class="Symbol">→</a> <a id="15169" href="/Soundness/#15090" class="Bound">γ</a> <a id="15171" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="15174" href="/Soundness/#15116" class="Bound">σ</a> <a id="15176" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="15178" href="/Soundness/#15104" class="Bound">γ₂</a>
             <a id="15194" class="Comment">-------------------------</a>
           <a id="15231" class="Symbol">→</a> <a id="15233" href="/Soundness/#15090" class="Bound">γ</a> <a id="15235" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="15238" href="/Soundness/#15116" class="Bound">σ</a> <a id="15240" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="15242" class="Symbol">(</a><a id="15243" href="/Soundness/#15101" class="Bound">γ₁</a> <a id="15246" href="/Denotational/#8605" class="Function Operator">`⊔</a> <a id="15249" href="/Soundness/#15104" class="Bound">γ₂</a><a id="15251" class="Symbol">)</a>
<a id="15253" href="/Soundness/#15073" class="Function">subst-⊔</a> <a id="15261" href="/Soundness/#15261" class="Bound">γ₁-ok</a> <a id="15267" href="/Soundness/#15267" class="Bound">γ₂-ok</a> <a id="15273" href="/Soundness/#15273" class="Bound">x</a> <a id="15275" class="Symbol">=</a> <a id="15277" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="15285" class="Symbol">(</a><a id="15286" href="/Soundness/#15261" class="Bound">γ₁-ok</a> <a id="15292" href="/Soundness/#15273" class="Bound">x</a><a id="15293" class="Symbol">)</a> <a id="15295" class="Symbol">(</a><a id="15296" href="/Soundness/#15267" class="Bound">γ₂-ok</a> <a id="15302" href="/Soundness/#15273" class="Bound">x</a><a id="15303" class="Symbol">)</a></pre>

<h3 id="the-lambda-constructor-is-injective">The Lambda constructor is injective</h3>

<pre class="Agda"><a id="lambda-inj"></a><a id="15371" href="/Soundness/#15371" class="Function">lambda-inj</a> <a id="15382" class="Symbol">:</a> <a id="15384" class="Symbol">∀</a> <a id="15386" class="Symbol">{</a><a id="15387" href="/Soundness/#15387" class="Bound">Γ</a><a id="15388" class="Symbol">}</a> <a id="15390" class="Symbol">{</a><a id="15391" href="/Soundness/#15391" class="Bound">M</a> <a id="15393" href="/Soundness/#15393" class="Bound">N</a> <a id="15395" class="Symbol">:</a> <a id="15397" href="/Soundness/#15387" class="Bound">Γ</a> <a id="15399" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15401" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15403" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15405" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15407" class="Symbol">}</a>
  <a id="15411" class="Symbol">→</a> <a id="15413" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a> <a id="15417" class="Symbol">{</a><a id="15418" class="Argument">A</a> <a id="15420" class="Symbol">=</a> <a id="15422" href="/Soundness/#15387" class="Bound">Γ</a> <a id="15424" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15426" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15427" class="Symbol">}</a> <a id="15429" class="Symbol">(</a><a id="15430" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15432" href="/Soundness/#15391" class="Bound">M</a><a id="15433" class="Symbol">)</a> <a id="15435" class="Symbol">(</a><a id="15436" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15438" href="/Soundness/#15393" class="Bound">N</a><a id="15439" class="Symbol">)</a>
    <a id="15445" class="Comment">---------------------------</a>
  <a id="15475" class="Symbol">→</a> <a id="15477" href="/Soundness/#15391" class="Bound">M</a> <a id="15479" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="15481" href="/Soundness/#15393" class="Bound">N</a>
<a id="15483" href="/Soundness/#15371" class="Function">lambda-inj</a> <a id="15494" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="15499" class="Symbol">=</a> <a id="15501" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<h3 id="simultaneous-substitution-reflects-denotations">Simultaneous substitution reflects denotations</h3>

<p>In this section we prove a central lemma, that
substitution reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>, then
<code class="highlighter-rouge">δ ⊢ M ↓ v</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> for some <code class="highlighter-rouge">δ</code>. We shall proceed by induction on
the derivation of <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>. This requires a minor
restatement of the lemma, changing the premise to <code class="highlighter-rouge">γ ⊢ L ↓ v</code> and
<code class="highlighter-rouge">L ≡ subst σ M</code>.</p>

<pre class="Agda"><a id="split"></a><a id="15923" href="/Soundness/#15923" class="Function">split</a> <a id="15929" class="Symbol">:</a> <a id="15931" class="Symbol">∀</a> <a id="15933" class="Symbol">{</a><a id="15934" href="/Soundness/#15934" class="Bound">Γ</a><a id="15935" class="Symbol">}</a> <a id="15937" class="Symbol">{</a><a id="15938" href="/Soundness/#15938" class="Bound">M</a> <a id="15940" class="Symbol">:</a> <a id="15942" href="/Soundness/#15934" class="Bound">Γ</a> <a id="15944" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15946" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15948" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15950" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15951" class="Symbol">}</a> <a id="15953" class="Symbol">{</a><a id="15954" href="/Soundness/#15954" class="Bound">δ</a> <a id="15956" class="Symbol">:</a> <a id="15958" href="/Denotational/#7331" class="Function">Env</a> <a id="15962" class="Symbol">(</a><a id="15963" href="/Soundness/#15934" class="Bound">Γ</a> <a id="15965" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15967" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15968" class="Symbol">)}</a> <a id="15971" class="Symbol">{</a><a id="15972" href="/Soundness/#15972" class="Bound">v</a><a id="15973" class="Symbol">}</a>
  <a id="15977" class="Symbol">→</a> <a id="15979" href="/Soundness/#15954" class="Bound">δ</a> <a id="15981" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="15983" href="/Soundness/#15938" class="Bound">M</a> <a id="15985" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="15987" href="/Soundness/#15972" class="Bound">v</a>
    <a id="15993" class="Comment">--------------------------</a>
  <a id="16022" class="Symbol">→</a> <a id="16024" class="Symbol">(</a><a id="16025" href="/Denotational/#7757" class="Function">init</a> <a id="16030" href="/Soundness/#15954" class="Bound">δ</a> <a id="16032" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="16035" href="/Denotational/#7812" class="Function">last</a> <a id="16040" href="/Soundness/#15954" class="Bound">δ</a><a id="16041" class="Symbol">)</a> <a id="16043" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="16045" href="/Soundness/#15938" class="Bound">M</a> <a id="16047" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="16049" href="/Soundness/#15972" class="Bound">v</a>
<a id="16051" href="/Soundness/#15923" class="Function">split</a> <a id="16057" class="Symbol">{</a><a id="16058" class="Argument">δ</a> <a id="16060" class="Symbol">=</a> <a id="16062" href="/Soundness/#16062" class="Bound">δ</a><a id="16063" class="Symbol">}</a> <a id="16065" href="/Soundness/#16065" class="Bound">δMv</a> <a id="16069" class="Keyword">rewrite</a> <a id="16077" href="/Denotational/#7861" class="Function">init-last</a> <a id="16087" href="/Soundness/#16062" class="Bound">δ</a> <a id="16089" class="Symbol">=</a> <a id="16091" href="/Soundness/#16065" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="16096" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="16110" class="Symbol">:</a> <a id="16112" class="Symbol">∀</a> <a id="16114" class="Symbol">{</a><a id="16115" href="/Soundness/#16115" class="Bound">Γ</a> <a id="16117" href="/Soundness/#16117" class="Bound">Δ</a><a id="16118" class="Symbol">}</a> <a id="16120" class="Symbol">{</a><a id="16121" href="/Soundness/#16121" class="Bound">δ</a> <a id="16123" class="Symbol">:</a> <a id="16125" href="/Denotational/#7331" class="Function">Env</a> <a id="16129" href="/Soundness/#16117" class="Bound">Δ</a><a id="16130" class="Symbol">}</a> <a id="16132" class="Symbol">{</a><a id="16133" href="/Soundness/#16133" class="Bound">M</a> <a id="16135" class="Symbol">:</a> <a id="16137" href="/Soundness/#16115" class="Bound">Γ</a> <a id="16139" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="16141" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="16142" class="Symbol">}</a> <a id="16144" class="Symbol">{</a><a id="16145" href="/Soundness/#16145" class="Bound">v</a><a id="16146" class="Symbol">}</a> <a id="16148" class="Symbol">{</a><a id="16149" href="/Soundness/#16149" class="Bound">L</a> <a id="16151" class="Symbol">:</a> <a id="16153" href="/Soundness/#16117" class="Bound">Δ</a> <a id="16155" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="16157" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="16158" class="Symbol">}</a> <a id="16160" class="Symbol">{</a><a id="16161" href="/Soundness/#16161" class="Bound">σ</a> <a id="16163" class="Symbol">:</a> <a id="16165" href="/Soundness/#2673" class="Function">Subst</a> <a id="16171" href="/Soundness/#16115" class="Bound">Γ</a> <a id="16173" href="/Soundness/#16117" class="Bound">Δ</a><a id="16174" class="Symbol">}</a>
  <a id="16178" class="Symbol">→</a> <a id="16180" href="/Soundness/#16121" class="Bound">δ</a> <a id="16182" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="16184" href="/Soundness/#16149" class="Bound">L</a> <a id="16186" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="16188" href="/Soundness/#16145" class="Bound">v</a>
  <a id="16192" class="Symbol">→</a> <a id="16194" href="/Untyped/#6931" class="Function">subst</a> <a id="16200" href="/Soundness/#16161" class="Bound">σ</a> <a id="16202" href="/Soundness/#16133" class="Bound">M</a> <a id="16204" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="16206" href="/Soundness/#16149" class="Bound">L</a>
    <a id="16212" class="Comment">---------------------------------------</a>
  <a id="16254" class="Symbol">→</a> <a id="16256" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="16259" href="/Soundness/#16259" class="Bound">γ</a> <a id="16261" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="16263" href="/Denotational/#7331" class="Function">Env</a> <a id="16267" href="/Soundness/#16115" class="Bound">Γ</a> <a id="16269" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="16271" href="/Soundness/#16121" class="Bound">δ</a> <a id="16273" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="16276" href="/Soundness/#16161" class="Bound">σ</a> <a id="16278" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="16280" href="/Soundness/#16259" class="Bound">γ</a>  <a id="16283" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="16286" href="/Soundness/#16259" class="Bound">γ</a> <a id="16288" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="16290" href="/Soundness/#16133" class="Bound">M</a> <a id="16292" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="16294" href="/Soundness/#16145" class="Bound">v</a>

<a id="16297" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="16311" class="Symbol">{</a><a id="16312" class="Argument">M</a> <a id="16314" class="Symbol">=</a> <a id="16316" href="/Soundness/#16316" class="Bound">M</a><a id="16317" class="Symbol">}{</a><a id="16319" class="Argument">σ</a> <a id="16321" class="Symbol">=</a> <a id="16323" href="/Soundness/#16323" class="Bound">σ</a><a id="16324" class="Symbol">}</a> <a id="16326" class="Symbol">(</a><a id="16327" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="16331" class="Symbol">{</a><a id="16332" class="Argument">x</a> <a id="16334" class="Symbol">=</a> <a id="16336" href="/Soundness/#16336" class="Bound">y</a><a id="16337" class="Symbol">})</a> <a id="16340" href="/Soundness/#16340" class="Bound">eqL</a> <a id="16344" class="Keyword">with</a> <a id="16349" href="/Soundness/#16316" class="Bound">M</a> 
<a id="16352" class="Symbol">...</a> <a id="16356" class="Symbol">|</a> <a id="16358" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16360" href="/Soundness/#16360" class="Bound">x</a>  <a id="16363" class="Keyword">with</a> <a id="16368" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="16372" class="Symbol">{</a><a id="16373" class="Argument">x</a> <a id="16375" class="Symbol">=</a> <a id="16377" class="Bound">y</a><a id="16378" class="Symbol">}</a>
<a id="16380" class="Symbol">...</a>           <a id="16394" class="Symbol">|</a> <a id="16396" href="/Soundness/#16396" class="Bound">yv</a>  <a id="16400" class="Keyword">rewrite</a> <a id="16408" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16412" class="Bound">eqL</a> <a id="16416" class="Symbol">=</a> <a id="16418" href="/Soundness/#14147" class="Function">subst-reflect-var</a> <a id="16436" class="Symbol">{</a><a id="16437" class="Argument">σ</a> <a id="16439" class="Symbol">=</a> <a id="16441" class="Bound">σ</a><a id="16442" class="Symbol">}</a> <a id="16444" href="/Soundness/#16396" class="Bound">yv</a>
<a id="16447" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="16461" class="Symbol">{</a><a id="16462" class="Argument">M</a> <a id="16464" class="Symbol">=</a> <a id="16466" href="/Soundness/#16466" class="Bound">M</a><a id="16467" class="Symbol">}</a> <a id="16469" class="Symbol">(</a><a id="16470" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="16474" class="Symbol">{</a><a id="16475" class="Argument">x</a> <a id="16477" class="Symbol">=</a> <a id="16479" href="/Soundness/#16479" class="Bound">y</a><a id="16480" class="Symbol">})</a> <a id="16483" class="Symbol">()</a> <a id="16486" class="Symbol">|</a> <a id="16488" href="/Soundness/#16488" class="Bound">M₁</a> <a id="16491" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16493" href="/Soundness/#16493" class="Bound">M₂</a>
<a id="16496" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="16510" class="Symbol">{</a><a id="16511" class="Argument">M</a> <a id="16513" class="Symbol">=</a> <a id="16515" href="/Soundness/#16515" class="Bound">M</a><a id="16516" class="Symbol">}</a> <a id="16518" class="Symbol">(</a><a id="16519" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="16523" class="Symbol">{</a><a id="16524" class="Argument">x</a> <a id="16526" class="Symbol">=</a> <a id="16528" href="/Soundness/#16528" class="Bound">y</a><a id="16529" class="Symbol">})</a> <a id="16532" class="Symbol">()</a> <a id="16535" class="Symbol">|</a> <a id="16537" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16539" href="/Soundness/#16539" class="Bound">M&#39;</a>

<a id="16543" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="16557" class="Symbol">{</a><a id="16558" class="Argument">M</a> <a id="16560" class="Symbol">=</a> <a id="16562" href="/Soundness/#16562" class="Bound">M</a><a id="16563" class="Symbol">}{</a><a id="16565" class="Argument">σ</a> <a id="16567" class="Symbol">=</a> <a id="16569" href="/Soundness/#16569" class="Bound">σ</a><a id="16570" class="Symbol">}</a> <a id="16572" class="Symbol">(</a><a id="16573" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="16580" href="/Soundness/#16580" class="Bound">d₁</a> <a id="16583" href="/Soundness/#16583" class="Bound">d₂</a><a id="16585" class="Symbol">)</a> <a id="16587" href="/Soundness/#16587" class="Bound">eqL</a>
         <a id="16600" class="Keyword">with</a> <a id="16605" href="/Soundness/#16562" class="Bound">M</a> 
<a id="16608" class="Symbol">...</a>    <a id="16615" class="Symbol">|</a> <a id="16617" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16619" href="/Soundness/#16619" class="Bound">x</a> <a id="16621" class="Keyword">with</a> <a id="16626" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="16633" class="Bound">d₁</a> <a id="16636" class="Bound">d₂</a> 
<a id="16640" class="Symbol">...</a>    <a id="16647" class="Symbol">|</a> <a id="16649" href="/Soundness/#16649" class="Bound">d&#39;</a> <a id="16652" class="Keyword">rewrite</a> <a id="16660" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16664" class="Bound">eqL</a> <a id="16668" class="Symbol">=</a> <a id="16670" href="/Soundness/#14147" class="Function">subst-reflect-var</a> <a id="16688" class="Symbol">{</a><a id="16689" class="Argument">σ</a> <a id="16691" class="Symbol">=</a> <a id="16693" class="Bound">σ</a><a id="16694" class="Symbol">}</a> <a id="16696" href="/Soundness/#16649" class="Bound">d&#39;</a>
<a id="16699" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="16713" class="Symbol">(</a><a id="16714" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="16721" href="/Soundness/#16721" class="Bound">d₁</a> <a id="16724" href="/Soundness/#16724" class="Bound">d₂</a><a id="16726" class="Symbol">)</a> <a id="16728" class="Symbol">()</a> <a id="16731" class="Symbol">|</a> <a id="16733" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16735" href="/Soundness/#16735" class="Bound">M&#39;</a>
<a id="16738" href="/Soundness/#16096" class="Function">subst-reflect</a><a id="16751" class="Symbol">{</a><a id="16752" href="/Soundness/#16752" class="Bound">Γ</a><a id="16753" class="Symbol">}{</a><a id="16755" href="/Soundness/#16755" class="Bound">Δ</a><a id="16756" class="Symbol">}{</a><a id="16758" href="/Soundness/#16758" class="Bound">γ</a><a id="16759" class="Symbol">}{</a><a id="16761" class="Argument">σ</a> <a id="16763" class="Symbol">=</a> <a id="16765" href="/Soundness/#16765" class="Bound">σ</a><a id="16766" class="Symbol">}</a> <a id="16768" class="Symbol">(</a><a id="16769" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="16776" href="/Soundness/#16776" class="Bound">d₁</a> <a id="16779" href="/Soundness/#16779" class="Bound">d₂</a><a id="16781" class="Symbol">)</a>
   <a id="16786" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16791" class="Symbol">|</a> <a id="16793" href="/Soundness/#16793" class="Bound">M₁</a> <a id="16796" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16798" href="/Soundness/#16798" class="Bound">M₂</a>
     <a id="16806" class="Keyword">with</a> <a id="16811" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="16825" class="Symbol">{</a><a id="16826" class="Argument">M</a> <a id="16828" class="Symbol">=</a> <a id="16830" href="/Soundness/#16793" class="Bound">M₁</a><a id="16832" class="Symbol">}</a> <a id="16834" href="/Soundness/#16776" class="Bound">d₁</a> <a id="16837" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16842" class="Symbol">|</a> <a id="16844" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="16858" class="Symbol">{</a><a id="16859" class="Argument">M</a> <a id="16861" class="Symbol">=</a> <a id="16863" href="/Soundness/#16798" class="Bound">M₂</a><a id="16865" class="Symbol">}</a> <a id="16867" href="/Soundness/#16779" class="Bound">d₂</a> <a id="16870" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="16875" class="Symbol">...</a>     <a id="16883" class="Symbol">|</a> <a id="16885" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16887" href="/Soundness/#16887" class="Bound">δ₁</a> <a id="16890" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16892" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16894" href="/Soundness/#16894" class="Bound">subst-δ₁</a> <a id="16903" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16905" href="/Soundness/#16905" class="Bound">m1</a> <a id="16908" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16910" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16912" class="Symbol">|</a> <a id="16914" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16916" href="/Soundness/#16916" class="Bound">δ₂</a> <a id="16919" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16921" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16923" href="/Soundness/#16923" class="Bound">subst-δ₂</a> <a id="16932" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16934" href="/Soundness/#16934" class="Bound">m2</a> <a id="16937" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16939" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16941" class="Symbol">=</a>
     <a id="16948" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16950" href="/Soundness/#16887" class="Bound">δ₁</a> <a id="16953" href="/Denotational/#8605" class="Function Operator">`⊔</a> <a id="16956" href="/Soundness/#16916" class="Bound">δ₂</a> <a id="16959" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16961" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16963" href="/Soundness/#15073" class="Function">subst-⊔</a> <a id="16971" class="Symbol">{</a><a id="16972" class="Argument">γ₁</a> <a id="16975" class="Symbol">=</a> <a id="16977" href="/Soundness/#16887" class="Bound">δ₁</a><a id="16979" class="Symbol">}{</a><a id="16981" class="Argument">γ₂</a> <a id="16984" class="Symbol">=</a> <a id="16986" href="/Soundness/#16916" class="Bound">δ₂</a><a id="16988" class="Symbol">}{</a><a id="16990" class="Argument">σ</a> <a id="16992" class="Symbol">=</a> <a id="16994" class="Bound">σ</a><a id="16995" class="Symbol">}</a> <a id="16997" href="/Soundness/#16894" class="Bound">subst-δ₁</a> <a id="17006" href="/Soundness/#16923" class="Bound">subst-δ₂</a> <a id="17015" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="17037" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="17044" class="Symbol">(</a><a id="17045" href="/Denotational/#26929" class="Function">Env⊑</a> <a id="17050" href="/Soundness/#16905" class="Bound">m1</a> <a id="17053" class="Symbol">(</a><a id="17054" href="/Denotational/#8943" class="Function">EnvConjR1⊑</a> <a id="17065" href="/Soundness/#16887" class="Bound">δ₁</a> <a id="17068" href="/Soundness/#16916" class="Bound">δ₂</a><a id="17070" class="Symbol">))</a>
                           <a id="17100" class="Symbol">(</a><a id="17101" href="/Denotational/#26929" class="Function">Env⊑</a> <a id="17106" href="/Soundness/#16934" class="Bound">m2</a> <a id="17109" class="Symbol">(</a><a id="17110" href="/Denotational/#9040" class="Function">EnvConjR2⊑</a> <a id="17121" href="/Soundness/#16887" class="Bound">δ₁</a> <a id="17124" href="/Soundness/#16916" class="Bound">δ₂</a><a id="17126" class="Symbol">))</a> <a id="17129" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17131" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="17134" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="17148" class="Symbol">{</a><a id="17149" class="Argument">M</a> <a id="17151" class="Symbol">=</a> <a id="17153" href="/Soundness/#17153" class="Bound">M</a><a id="17154" class="Symbol">}{</a><a id="17156" class="Argument">σ</a> <a id="17158" class="Symbol">=</a> <a id="17160" href="/Soundness/#17160" class="Bound">σ</a><a id="17161" class="Symbol">}</a> <a id="17163" class="Symbol">(</a><a id="17164" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="17172" href="/Soundness/#17172" class="Bound">d</a><a id="17173" class="Symbol">)</a> <a id="17175" href="/Soundness/#17175" class="Bound">eqL</a> <a id="17179" class="Keyword">with</a> <a id="17184" href="/Soundness/#17153" class="Bound">M</a>
<a id="17186" class="Symbol">...</a>    <a id="17193" class="Symbol">|</a> <a id="17195" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="17197" href="/Soundness/#17197" class="Bound">x</a> <a id="17199" class="Keyword">with</a> <a id="17204" class="Symbol">(</a><a id="17205" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="17213" class="Bound">d</a><a id="17214" class="Symbol">)</a>
<a id="17216" class="Symbol">...</a>             <a id="17232" class="Symbol">|</a> <a id="17234" href="/Soundness/#17234" class="Bound">d&#39;</a> <a id="17237" class="Keyword">rewrite</a> <a id="17245" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="17249" class="Bound">eqL</a> <a id="17253" class="Symbol">=</a> <a id="17255" href="/Soundness/#14147" class="Function">subst-reflect-var</a> <a id="17273" class="Symbol">{</a><a id="17274" class="Argument">σ</a> <a id="17276" class="Symbol">=</a> <a id="17278" class="Bound">σ</a><a id="17279" class="Symbol">}</a> <a id="17281" href="/Soundness/#17234" class="Bound">d&#39;</a>
<a id="17284" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="17298" class="Symbol">{</a><a id="17299" class="Argument">σ</a> <a id="17301" class="Symbol">=</a> <a id="17303" href="/Soundness/#17303" class="Bound">σ</a><a id="17304" class="Symbol">}</a> <a id="17306" class="Symbol">(</a><a id="17307" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="17315" href="/Soundness/#17315" class="Bound">d</a><a id="17316" class="Symbol">)</a> <a id="17318" href="/Soundness/#17318" class="Bound">eq</a> <a id="17321" class="Symbol">|</a> <a id="17323" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="17325" href="/Soundness/#17325" class="Bound">M&#39;</a>
      <a id="17334" class="Keyword">with</a> <a id="17339" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="17353" class="Symbol">{</a><a id="17354" class="Argument">σ</a> <a id="17356" class="Symbol">=</a> <a id="17358" href="/Untyped/#6623" class="Function">exts</a> <a id="17363" href="/Soundness/#17303" class="Bound">σ</a><a id="17364" class="Symbol">}</a> <a id="17366" href="/Soundness/#17315" class="Bound">d</a> <a id="17368" class="Symbol">(</a><a id="17369" href="/Soundness/#15371" class="Function">lambda-inj</a> <a id="17380" href="/Soundness/#17318" class="Bound">eq</a><a id="17382" class="Symbol">)</a>
<a id="17384" class="Symbol">...</a> <a id="17388" class="Symbol">|</a> <a id="17390" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17392" href="/Soundness/#17392" class="Bound">δ′</a> <a id="17395" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17397" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17399" href="/Soundness/#17399" class="Bound">exts-σ-δ′</a> <a id="17409" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17411" href="/Soundness/#17411" class="Bound">m′</a> <a id="17414" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17416" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17418" class="Symbol">=</a> 
    <a id="17425" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17427" href="/Denotational/#7757" class="Function">init</a> <a id="17432" href="/Soundness/#17392" class="Bound">δ′</a> <a id="17435" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17437" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17439" class="Symbol">((λ</a> <a id="17443" href="/Soundness/#17443" class="Bound">x</a> <a id="17445" class="Symbol">→</a> <a id="17447" href="/Soundness/#11285" class="Function">rename-inc-reflect</a> <a id="17466" class="Symbol">(</a><a id="17467" href="/Soundness/#17399" class="Bound">exts-σ-δ′</a> <a id="17477" class="Symbol">(</a><a id="17478" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="17480" href="/Soundness/#17443" class="Bound">x</a><a id="17481" class="Symbol">))))</a> <a id="17486" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
             <a id="17501" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="17509" class="Symbol">(</a><a id="17510" href="/Denotational/#27363" class="Function">up-env</a> <a id="17517" class="Symbol">(</a><a id="17518" href="/Soundness/#15923" class="Function">split</a> <a id="17524" href="/Soundness/#17411" class="Bound">m′</a><a id="17526" class="Symbol">)</a> <a id="17528" class="Symbol">(</a><a id="17529" href="/Compositional/#9007" class="Function">var-inv</a> <a id="17537" class="Symbol">(</a><a id="17538" href="/Soundness/#17399" class="Bound">exts-σ-δ′</a> <a id="17548" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="17549" class="Symbol">)))</a> <a id="17553" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17555" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17557" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="17571" class="Symbol">(</a><a id="17572" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="17580" href="/Soundness/#17580" class="Bound">d</a><a id="17581" class="Symbol">)</a> <a id="17583" class="Symbol">()</a> <a id="17586" class="Symbol">|</a> <a id="17588" href="/Soundness/#17588" class="Bound">M₁</a> <a id="17591" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="17593" href="/Soundness/#17593" class="Bound">M₂</a> 

<a id="17598" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="17612" class="Symbol">{</a><a id="17613" class="Argument">σ</a> <a id="17615" class="Symbol">=</a> <a id="17617" href="/Soundness/#17617" class="Bound">σ</a><a id="17618" class="Symbol">}</a> <a id="17620" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="17628" href="/Soundness/#17628" class="Bound">eq</a> <a id="17631" class="Symbol">=</a>
    <a id="17637" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17639" href="/Denotational/#8576" class="Function">`⊥</a> <a id="17642" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17644" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17646" href="/Soundness/#14802" class="Function">subst-⊥</a> <a id="17654" class="Symbol">{</a><a id="17655" class="Argument">σ</a> <a id="17657" class="Symbol">=</a> <a id="17659" href="/Soundness/#17617" class="Bound">σ</a><a id="17660" class="Symbol">}</a> <a id="17662" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17664" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="17672" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17674" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="17677" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="17691" class="Symbol">{</a><a id="17692" class="Argument">σ</a> <a id="17694" class="Symbol">=</a> <a id="17696" href="/Soundness/#17696" class="Bound">σ</a><a id="17697" class="Symbol">}</a> <a id="17699" class="Symbol">(</a><a id="17700" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="17708" href="/Soundness/#17708" class="Bound">d₁</a> <a id="17711" href="/Soundness/#17711" class="Bound">d₂</a><a id="17713" class="Symbol">)</a> <a id="17715" href="/Soundness/#17715" class="Bound">eq</a>
  <a id="17720" class="Keyword">with</a> <a id="17725" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="17739" class="Symbol">{</a><a id="17740" class="Argument">σ</a> <a id="17742" class="Symbol">=</a> <a id="17744" href="/Soundness/#17696" class="Bound">σ</a><a id="17745" class="Symbol">}</a> <a id="17747" href="/Soundness/#17708" class="Bound">d₁</a> <a id="17750" href="/Soundness/#17715" class="Bound">eq</a> <a id="17753" class="Symbol">|</a> <a id="17755" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="17769" class="Symbol">{</a><a id="17770" class="Argument">σ</a> <a id="17772" class="Symbol">=</a> <a id="17774" href="/Soundness/#17696" class="Bound">σ</a><a id="17775" class="Symbol">}</a> <a id="17777" href="/Soundness/#17711" class="Bound">d₂</a> <a id="17780" href="/Soundness/#17715" class="Bound">eq</a>
<a id="17783" class="Symbol">...</a> <a id="17787" class="Symbol">|</a> <a id="17789" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17791" href="/Soundness/#17791" class="Bound">δ₁</a> <a id="17794" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17796" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17798" href="/Soundness/#17798" class="Bound">subst-δ₁</a> <a id="17807" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17809" href="/Soundness/#17809" class="Bound">m1</a> <a id="17812" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17814" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17816" class="Symbol">|</a> <a id="17818" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17820" href="/Soundness/#17820" class="Bound">δ₂</a> <a id="17823" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17825" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17827" href="/Soundness/#17827" class="Bound">subst-δ₂</a> <a id="17836" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17838" href="/Soundness/#17838" class="Bound">m2</a> <a id="17841" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17843" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17845" class="Symbol">=</a>
     <a id="17852" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17854" href="/Soundness/#17791" class="Bound">δ₁</a> <a id="17857" href="/Denotational/#8605" class="Function Operator">`⊔</a> <a id="17860" href="/Soundness/#17820" class="Bound">δ₂</a> <a id="17863" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17865" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17867" href="/Soundness/#15073" class="Function">subst-⊔</a> <a id="17875" class="Symbol">{</a><a id="17876" class="Argument">γ₁</a> <a id="17879" class="Symbol">=</a> <a id="17881" href="/Soundness/#17791" class="Bound">δ₁</a><a id="17883" class="Symbol">}{</a><a id="17885" class="Argument">γ₂</a> <a id="17888" class="Symbol">=</a> <a id="17890" href="/Soundness/#17820" class="Bound">δ₂</a><a id="17892" class="Symbol">}{</a><a id="17894" class="Argument">σ</a> <a id="17896" class="Symbol">=</a> <a id="17898" class="Bound">σ</a><a id="17899" class="Symbol">}</a> <a id="17901" href="/Soundness/#17798" class="Bound">subst-δ₁</a> <a id="17910" href="/Soundness/#17827" class="Bound">subst-δ₂</a> <a id="17919" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="17941" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="17949" class="Symbol">(</a><a id="17950" href="/Denotational/#26929" class="Function">Env⊑</a> <a id="17955" href="/Soundness/#17809" class="Bound">m1</a> <a id="17958" class="Symbol">(</a><a id="17959" href="/Denotational/#8943" class="Function">EnvConjR1⊑</a> <a id="17970" href="/Soundness/#17791" class="Bound">δ₁</a> <a id="17973" href="/Soundness/#17820" class="Bound">δ₂</a><a id="17975" class="Symbol">))</a>
                            <a id="18006" class="Symbol">(</a><a id="18007" href="/Denotational/#26929" class="Function">Env⊑</a> <a id="18012" href="/Soundness/#17838" class="Bound">m2</a> <a id="18015" class="Symbol">(</a><a id="18016" href="/Denotational/#9040" class="Function">EnvConjR2⊑</a> <a id="18027" href="/Soundness/#17791" class="Bound">δ₁</a> <a id="18030" href="/Soundness/#17820" class="Bound">δ₂</a><a id="18032" class="Symbol">))</a> <a id="18035" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18037" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="18039" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="18053" class="Symbol">(</a><a id="18054" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="18058" href="/Soundness/#18058" class="Bound">d</a> <a id="18060" href="/Soundness/#18060" class="Bound">lt</a><a id="18062" class="Symbol">)</a> <a id="18064" href="/Soundness/#18064" class="Bound">eq</a> 
    <a id="18072" class="Keyword">with</a> <a id="18077" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="18091" href="/Soundness/#18058" class="Bound">d</a> <a id="18093" href="/Soundness/#18064" class="Bound">eq</a>
<a id="18096" class="Symbol">...</a> <a id="18100" class="Symbol">|</a> <a id="18102" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18104" href="/Soundness/#18104" class="Bound">δ</a> <a id="18106" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18108" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18110" href="/Soundness/#18110" class="Bound">subst-δ</a> <a id="18118" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18120" href="/Soundness/#18120" class="Bound">m</a> <a id="18122" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18124" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18126" class="Symbol">=</a> <a id="18128" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18130" href="/Soundness/#18104" class="Bound">δ</a> <a id="18132" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18134" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18136" href="/Soundness/#18110" class="Bound">subst-δ</a> <a id="18144" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18146" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="18150" href="/Soundness/#18120" class="Bound">m</a> <a id="18152" class="Bound">lt</a> <a id="18155" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18157" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<ul>
  <li>
    <p>Case <code class="highlighter-rouge">var</code>: We have subst <code class="highlighter-rouge">σ M ≡ y</code>, so <code class="highlighter-rouge">M</code> must also be a variable, say <code class="highlighter-rouge">x</code>.
We apply the lemma <code class="highlighter-rouge">subst-reflect-var</code> to conclude.</p>
  </li>
  <li>Case <code class="highlighter-rouge">↦-elim</code>: We have <code class="highlighter-rouge">subst σ M ≡ L₁ · L₂</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma again to conclude.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ M₁ · M₂</code>: By the induction hypothesis, we have
some <code class="highlighter-rouge">δ₁</code> and <code class="highlighter-rouge">δ₂</code> such that <code class="highlighter-rouge">δ₁ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁</code>,
as well as <code class="highlighter-rouge">δ₂ ⊢ M₂ ↓ v₁</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₂</code>.
By <code class="highlighter-rouge">Env⊑</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁</code>
(using <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>), and therefore
<code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃</code>.
We conclude this case by obtaining <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁ ⊔ δ₂</code>
by the <code class="highlighter-rouge">subst-⊔</code> lemma.</p>
      </li>
    </ul>
  </li>
  <li>Case <code class="highlighter-rouge">↦-intro</code>: We have <code class="highlighter-rouge">subst σ M ≡ ƛ L'</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ ƛ M'</code>: By the induction hypothesis, we have
<code class="highlighter-rouge">(δ' , v') ⊢ M' ↓ v₂</code> and <code class="highlighter-rouge">(δ , v₁) ⊢ exts σ ↓ (δ' , v')</code>.
From the later we have <code class="highlighter-rouge">(δ , v₁) ⊢ # 0 ↓ v'</code>.
By the lemma <code class="highlighter-rouge">var-inv</code> we have <code class="highlighter-rouge">v' ⊑ v₁</code>, so by the <code class="highlighter-rouge">up-env</code> lemma we
have <code class="highlighter-rouge">(δ' , v₁) ⊢ M' ↓ v₂</code> and therefore <code class="highlighter-rouge">δ' ⊢ ƛ M' ↓ v₁ → v₂</code>.  We
also need to show that <code class="highlighter-rouge">δ </code>⊢ σ ↓ δ’<code class="highlighter-rouge">.  Fix </code>k<code class="highlighter-rouge">. We have
</code>(δ , v₁) ⊢ rename S_ σ k ↓ nth k δ’<code class="highlighter-rouge">.  We then apply the lemma
</code>rename-inc-reflect<code class="highlighter-rouge"> to obtain </code>δ ⊢ σ k ↓ nth k δ’`, so this case is
complete.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Case <code class="highlighter-rouge">⊥-intro</code>: We choose <code class="highlighter-rouge">⊥</code> for <code class="highlighter-rouge">δ</code>.
We have <code class="highlighter-rouge">⊥ ⊢ M ↓ ⊥</code> by <code class="highlighter-rouge">⊥-intro</code>.
We have <code class="highlighter-rouge">δ ⊢ σ ↓ ⊥</code> by the lemma <code class="highlighter-rouge">subst-empty</code>.</p>
  </li>
  <li>Case <code class="highlighter-rouge">⊔-intro</code>: By the induction hypothesis we have
<code class="highlighter-rouge">δ₁ ⊢ M ↓ v₁</code>, <code class="highlighter-rouge">δ₂ ⊢ M ↓ v₂</code>, <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁</code>, and <code class="highlighter-rouge">δ ⊢ σ ↓ δ₂</code>.
We have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₂</code>
by <code class="highlighter-rouge">Env⊑</code> with <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>.
So by <code class="highlighter-rouge">⊔-intro</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂</code>.
By <code class="highlighter-rouge">subst-⊔</code> we conclude that <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁ ⊔ δ₂</code>.</li>
</ul>

<h3 id="single-substitution-reflects-denotations">Single substitution reflects denotations</h3>

<p>Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, β reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
give terms <code class="highlighter-rouge">N : (Γ , ★ ⊢ ★)</code> and <code class="highlighter-rouge">M : (Γ ⊢ ★)</code>,
if <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ w</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code> and <code class="highlighter-rouge">(γ , v) ⊢ N ↓ w</code>
for some value <code class="highlighter-rouge">v</code>. We have <code class="highlighter-rouge">N [ M ] = subst (subst-zero M) N</code>.
We apply the <code class="highlighter-rouge">subst-reflect</code> lemma to obtain
<code class="highlighter-rouge">γ ⊢ subst-zero M ↓ (δ' , v')</code> and <code class="highlighter-rouge">(δ' , v') ⊢ N ↓ w</code>
for some <code class="highlighter-rouge">δ'</code> and <code class="highlighter-rouge">v'</code>.</p>

<p>Instantiating <code class="highlighter-rouge">γ ⊢ subst-zero M ↓ (δ' , v')</code> at <code class="highlighter-rouge">k = 0</code>
gives us <code class="highlighter-rouge">γ ⊢ M ↓ v'</code>. We choose <code class="highlighter-rouge">w = v'</code>, so the first
part of our conclusion is complete.</p>

<p>It remains to prove <code class="highlighter-rouge">(γ , v') ⊢ N ↓ v</code>. First, we obtain 
<code class="highlighter-rouge">(γ , v') ⊢ rename var-id N ↓ v</code> by the <code class="highlighter-rouge">rename-pres</code> lemma
applied to <code class="highlighter-rouge">(δ' , v') ⊢ N ↓ v</code>, with the <code class="highlighter-rouge">var-id</code> renaming,
<code class="highlighter-rouge">γ = (δ' , v')</code>, and <code class="highlighter-rouge">δ = (γ , v')</code>. To apply this lemma,
we need to show that 
<code class="highlighter-rouge">nth n (δ' , v') ⊑ nth (var-id n) (γ , v')</code> for any <code class="highlighter-rouge">n</code>.
This is accomplished by the following lemma, which
makes use of <code class="highlighter-rouge">γ ⊢ subst-zero M ↓ (δ' , v')</code>.</p>

<pre class="Agda"><a id="nth-id-le"></a><a id="21163" href="/Soundness/#21163" class="Function">nth-id-le</a> <a id="21173" class="Symbol">:</a> <a id="21175" class="Symbol">∀{</a><a id="21177" href="/Soundness/#21177" class="Bound">Γ</a><a id="21178" class="Symbol">}{</a><a id="21180" href="/Soundness/#21180" class="Bound">δ&#39;</a><a id="21182" class="Symbol">}{</a><a id="21184" href="/Soundness/#21184" class="Bound">v&#39;</a><a id="21186" class="Symbol">}{</a><a id="21188" href="/Soundness/#21188" class="Bound">γ</a><a id="21189" class="Symbol">}{</a><a id="21191" href="/Soundness/#21191" class="Bound">M</a><a id="21192" class="Symbol">}</a>
      <a id="21200" class="Symbol">→</a> <a id="21202" href="/Soundness/#21188" class="Bound">γ</a> <a id="21204" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="21207" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="21218" href="/Soundness/#21191" class="Bound">M</a> <a id="21220" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="21222" class="Symbol">(</a><a id="21223" href="/Soundness/#21180" class="Bound">δ&#39;</a> <a id="21226" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="21229" href="/Soundness/#21184" class="Bound">v&#39;</a><a id="21231" class="Symbol">)</a>
        <a id="21241" class="Comment">-----------------------------------------------------</a>
      <a id="21301" class="Symbol">→</a> <a id="21303" class="Symbol">(</a><a id="21304" href="/Soundness/#21304" class="Bound">x</a> <a id="21306" class="Symbol">:</a> <a id="21308" href="/Soundness/#21177" class="Bound">Γ</a> <a id="21310" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="21312" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="21314" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="21316" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21317" class="Symbol">)</a> <a id="21319" class="Symbol">→</a> <a id="21321" class="Symbol">(</a><a id="21322" href="/Soundness/#21180" class="Bound">δ&#39;</a> <a id="21325" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="21328" href="/Soundness/#21184" class="Bound">v&#39;</a><a id="21330" class="Symbol">)</a> <a id="21332" href="/Soundness/#21304" class="Bound">x</a> <a id="21334" href="/Denotational/#4468" class="Datatype Operator">⊑</a> <a id="21336" class="Symbol">(</a><a id="21337" href="/Soundness/#21188" class="Bound">γ</a> <a id="21339" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="21342" href="/Soundness/#21184" class="Bound">v&#39;</a><a id="21344" class="Symbol">)</a> <a id="21346" class="Symbol">(</a><a id="21347" href="/Denotational/#26581" class="Function">var-id</a> <a id="21354" href="/Soundness/#21304" class="Bound">x</a><a id="21355" class="Symbol">)</a> 
<a id="21358" href="/Soundness/#21163" class="Function">nth-id-le</a> <a id="21368" href="/Soundness/#21368" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="21378" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="21380" class="Symbol">=</a> <a id="21382" href="/Denotational/#5638" class="Function">Refl⊑</a>
<a id="21388" href="/Soundness/#21163" class="Function">nth-id-le</a> <a id="21398" href="/Soundness/#21398" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="21408" class="Symbol">(</a><a id="21409" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21411" href="/Soundness/#21411" class="Bound">n&#39;</a><a id="21413" class="Symbol">)</a> <a id="21415" class="Symbol">=</a> <a id="21417" href="/Compositional/#9007" class="Function">var-inv</a> <a id="21425" class="Symbol">(</a><a id="21426" href="/Soundness/#21398" class="Bound">γ-sz-δ&#39;v&#39;</a> <a id="21436" class="Symbol">(</a><a id="21437" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21439" href="/Soundness/#21411" class="Bound">n&#39;</a><a id="21441" class="Symbol">))</a></pre>

<p>The above lemma proceeds by induction on <code class="highlighter-rouge">n</code>.</p>

<ul>
  <li>If it is <code class="highlighter-rouge">Z</code>, then we show that <code class="highlighter-rouge">v' ⊑ v'</code> by <code class="highlighter-rouge">Refl⊑</code>.</li>
  <li>If it is <code class="highlighter-rouge">S n'</code>, then from the premise we obtain
<code class="highlighter-rouge">γ ⊢ # n' ↓ nth n' δ'</code>. By <code class="highlighter-rouge">var-inv</code> we have
<code class="highlighter-rouge">nth n' δ' ⊑ nth n' γ</code> from which we conclude that
<code class="highlighter-rouge">nth (S n') (δ' , v') ⊑ nth (var-id (S n')) (γ , v')</code>.</li>
</ul>

<p>Returning to the proof that single substitution reflects
denotations, we have just proved that</p>

<p>(γ `, v’) ⊢ rename var-id N ↓ v</p>

<p>but we need to show <code class="highlighter-rouge">(γ </code>, v’) ⊢ N ↓ v<code class="highlighter-rouge">.
So we apply the </code>rename-id<code class="highlighter-rouge"> lemma to obtain
</code>rename var-id N ≡ N`.</p>

<p>The following is the formal version of this proof.</p>

<pre class="Agda"><a id="subst-zero-reflect"></a><a id="22073" href="/Soundness/#22073" class="Function">subst-zero-reflect</a> <a id="22092" class="Symbol">:</a> <a id="22094" class="Symbol">∀</a> <a id="22096" class="Symbol">{</a><a id="22097" href="/Soundness/#22097" class="Bound">Δ</a><a id="22098" class="Symbol">}</a> <a id="22100" class="Symbol">{</a><a id="22101" href="/Soundness/#22101" class="Bound">δ</a> <a id="22103" class="Symbol">:</a> <a id="22105" href="/Denotational/#7331" class="Function">Env</a> <a id="22109" href="/Soundness/#22097" class="Bound">Δ</a><a id="22110" class="Symbol">}</a> <a id="22112" class="Symbol">{</a><a id="22113" href="/Soundness/#22113" class="Bound">γ</a> <a id="22115" class="Symbol">:</a> <a id="22117" href="/Denotational/#7331" class="Function">Env</a> <a id="22121" class="Symbol">(</a><a id="22122" href="/Soundness/#22097" class="Bound">Δ</a> <a id="22124" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="22126" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="22127" class="Symbol">)}</a> <a id="22130" class="Symbol">{</a><a id="22131" href="/Soundness/#22131" class="Bound">M</a> <a id="22133" class="Symbol">:</a> <a id="22135" href="/Soundness/#22097" class="Bound">Δ</a> <a id="22137" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="22139" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="22140" class="Symbol">}</a>
  <a id="22144" class="Symbol">→</a> <a id="22146" href="/Soundness/#22101" class="Bound">δ</a> <a id="22148" href="/Soundness/#3177" class="Function Operator">`⊢</a> <a id="22151" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="22162" href="/Soundness/#22131" class="Bound">M</a> <a id="22164" href="/Soundness/#3177" class="Function Operator">↓</a> <a id="22166" href="/Soundness/#22113" class="Bound">γ</a>
    <a id="22172" class="Comment">----------------------------------------</a>
  <a id="22215" class="Symbol">→</a> <a id="22217" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="22220" href="/Soundness/#22220" class="Bound">w</a> <a id="22222" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="22224" href="/Denotational/#4097" class="Datatype">Value</a> <a id="22230" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="22232" href="/Soundness/#22113" class="Bound">γ</a> <a id="22234" href="/Denotational/#8357" class="Function Operator">`⊑</a> <a id="22237" class="Symbol">(</a><a id="22238" href="/Soundness/#22101" class="Bound">δ</a> <a id="22240" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="22243" href="/Soundness/#22220" class="Bound">w</a><a id="22244" class="Symbol">)</a> <a id="22246" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a> <a id="22248" href="/Soundness/#22101" class="Bound">δ</a> <a id="22250" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="22252" href="/Soundness/#22131" class="Bound">M</a> <a id="22254" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="22256" href="/Soundness/#22220" class="Bound">w</a>
<a id="22258" href="/Soundness/#22073" class="Function">subst-zero-reflect</a> <a id="22277" class="Symbol">{</a><a id="22278" class="Argument">δ</a> <a id="22280" class="Symbol">=</a> <a id="22282" href="/Soundness/#22282" class="Bound">δ</a><a id="22283" class="Symbol">}</a> <a id="22285" class="Symbol">{</a><a id="22286" class="Argument">γ</a> <a id="22288" class="Symbol">=</a> <a id="22290" href="/Soundness/#22290" class="Bound">γ</a><a id="22291" class="Symbol">}</a> <a id="22293" href="/Soundness/#22293" class="Bound">δσγ</a> <a id="22297" class="Symbol">=</a> <a id="22299" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22301" href="/Denotational/#7812" class="Function">last</a> <a id="22306" href="/Soundness/#22290" class="Bound">γ</a> <a id="22308" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22310" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22312" href="/Soundness/#22343" class="Function">lemma</a> <a id="22318" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22320" href="/Soundness/#22293" class="Bound">δσγ</a> <a id="22324" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="22326" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22328" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>   
  <a id="22335" class="Keyword">where</a>
  <a id="22343" href="/Soundness/#22343" class="Function">lemma</a> <a id="22349" class="Symbol">:</a> <a id="22351" href="/Soundness/#22290" class="Bound">γ</a> <a id="22353" href="/Denotational/#8357" class="Function Operator">`⊑</a> <a id="22356" class="Symbol">(</a><a id="22357" href="/Soundness/#22282" class="Bound">δ</a> <a id="22359" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="22362" href="/Denotational/#7812" class="Function">last</a> <a id="22367" href="/Soundness/#22290" class="Bound">γ</a><a id="22368" class="Symbol">)</a>
  <a id="22372" href="/Soundness/#22343" class="Function">lemma</a> <a id="22378" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="22381" class="Symbol">=</a>  <a id="22384" href="/Denotational/#5638" class="Function">Refl⊑</a>
  <a id="22392" href="/Soundness/#22343" class="Function">lemma</a> <a id="22398" class="Symbol">(</a><a id="22399" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="22401" href="/Soundness/#22401" class="Bound">x</a><a id="22402" class="Symbol">)</a> <a id="22404" class="Symbol">=</a> <a id="22406" href="/Compositional/#9007" class="Function">var-inv</a> <a id="22414" class="Symbol">(</a><a id="22415" href="/Soundness/#22293" class="Bound">δσγ</a> <a id="22419" class="Symbol">(</a><a id="22420" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="22422" href="/Soundness/#22401" class="Bound">x</a><a id="22423" class="Symbol">))</a>
  
<a id="substitution-reflect"></a><a id="22429" href="/Soundness/#22429" class="Function">substitution-reflect</a> <a id="22450" class="Symbol">:</a> <a id="22452" class="Symbol">∀</a> <a id="22454" class="Symbol">{</a><a id="22455" href="/Soundness/#22455" class="Bound">Δ</a><a id="22456" class="Symbol">}</a> <a id="22458" class="Symbol">{</a><a id="22459" href="/Soundness/#22459" class="Bound">δ</a> <a id="22461" class="Symbol">:</a> <a id="22463" href="/Denotational/#7331" class="Function">Env</a> <a id="22467" href="/Soundness/#22455" class="Bound">Δ</a><a id="22468" class="Symbol">}</a> <a id="22470" class="Symbol">{</a><a id="22471" href="/Soundness/#22471" class="Bound">N</a> <a id="22473" class="Symbol">:</a> <a id="22475" href="/Soundness/#22455" class="Bound">Δ</a> <a id="22477" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="22479" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="22481" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="22483" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="22484" class="Symbol">}</a> <a id="22486" class="Symbol">{</a><a id="22487" href="/Soundness/#22487" class="Bound">M</a> <a id="22489" class="Symbol">:</a> <a id="22491" href="/Soundness/#22455" class="Bound">Δ</a> <a id="22493" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="22495" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="22496" class="Symbol">}</a> <a id="22498" class="Symbol">{</a><a id="22499" href="/Soundness/#22499" class="Bound">v</a><a id="22500" class="Symbol">}</a>
  <a id="22504" class="Symbol">→</a> <a id="22506" href="/Soundness/#22459" class="Bound">δ</a> <a id="22508" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="22510" href="/Soundness/#22471" class="Bound">N</a> <a id="22512" href="/Untyped/#7475" class="Function Operator">[</a> <a id="22514" href="/Soundness/#22487" class="Bound">M</a> <a id="22516" href="/Untyped/#7475" class="Function Operator">]</a> <a id="22518" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="22520" href="/Soundness/#22499" class="Bound">v</a>
    <a id="22526" class="Comment">------------------------------------------------</a>
  <a id="22577" class="Symbol">→</a> <a id="22579" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">Σ[</a> <a id="22582" href="/Soundness/#22582" class="Bound">w</a> <a id="22584" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">∈</a> <a id="22586" href="/Denotational/#4097" class="Datatype">Value</a> <a id="22592" href="https://agda.github.io/agda-stdlib/Data.Product.html#764" class="Function">]</a> <a id="22594" href="/Soundness/#22459" class="Bound">δ</a> <a id="22596" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="22598" href="/Soundness/#22487" class="Bound">M</a> <a id="22600" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="22602" href="/Soundness/#22582" class="Bound">w</a>  <a id="22605" href="https://agda.github.io/agda-stdlib/Data.Product.html#1353" class="Function Operator">×</a>  <a id="22608" class="Symbol">(</a><a id="22609" href="/Soundness/#22459" class="Bound">δ</a> <a id="22611" href="/Denotational/#7504" class="Function Operator">`,</a> <a id="22614" href="/Soundness/#22582" class="Bound">w</a><a id="22615" class="Symbol">)</a> <a id="22617" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="22619" href="/Soundness/#22471" class="Bound">N</a> <a id="22621" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="22623" href="/Soundness/#22499" class="Bound">v</a>
<a id="22625" href="/Soundness/#22429" class="Function">substitution-reflect</a> <a id="22646" href="/Soundness/#22646" class="Bound">d</a> <a id="22648" class="Keyword">with</a> <a id="22653" href="/Soundness/#16096" class="Function">subst-reflect</a> <a id="22667" href="/Soundness/#22646" class="Bound">d</a> <a id="22669" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="22674" class="Symbol">...</a>  <a id="22679" class="Symbol">|</a> <a id="22681" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22683" href="/Soundness/#22683" class="Bound">γ</a> <a id="22685" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22687" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22689" href="/Soundness/#22689" class="Bound">δσγ</a> <a id="22693" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22695" href="/Soundness/#22695" class="Bound">γNv</a> <a id="22699" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22701" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22703" class="Keyword">with</a> <a id="22708" href="/Soundness/#22073" class="Function">subst-zero-reflect</a> <a id="22727" href="/Soundness/#22689" class="Bound">δσγ</a>
<a id="22731" class="Symbol">...</a>    <a id="22738" class="Symbol">|</a> <a id="22740" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22742" href="/Soundness/#22742" class="Bound">w</a> <a id="22744" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22746" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22748" href="/Soundness/#22748" class="Bound">ineq</a> <a id="22753" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22755" href="/Soundness/#22755" class="Bound">δMw</a> <a id="22759" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22761" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22763" class="Symbol">=</a> <a id="22765" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22767" href="/Soundness/#22742" class="Bound">w</a> <a id="22769" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22771" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22773" href="/Soundness/#22755" class="Bound">δMw</a> <a id="22777" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22779" href="/Denotational/#26929" class="Function">Env⊑</a> <a id="22784" class="Bound">γNv</a> <a id="22788" href="/Soundness/#22748" class="Bound">ineq</a> <a id="22793" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22795" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<h3 id="reduction-reflects-denotations-1">Reduction reflects denotations</h3>

<p>Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.</p>

<pre class="Agda"><a id="reflect-beta"></a><a id="22969" href="/Soundness/#22969" class="Function">reflect-beta</a> <a id="22982" class="Symbol">:</a> <a id="22984" class="Symbol">∀{</a><a id="22986" href="/Soundness/#22986" class="Bound">Γ</a><a id="22987" class="Symbol">}{</a><a id="22989" href="/Soundness/#22989" class="Bound">γ</a> <a id="22991" class="Symbol">:</a> <a id="22993" href="/Denotational/#7331" class="Function">Env</a> <a id="22997" href="/Soundness/#22986" class="Bound">Γ</a><a id="22998" class="Symbol">}{</a><a id="23000" href="/Soundness/#23000" class="Bound">M</a> <a id="23002" href="/Soundness/#23002" class="Bound">N</a><a id="23003" class="Symbol">}{</a><a id="23005" href="/Soundness/#23005" class="Bound">v</a><a id="23006" class="Symbol">}</a>
    <a id="23012" class="Symbol">→</a> <a id="23014" href="/Soundness/#22989" class="Bound">γ</a> <a id="23016" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="23018" class="Symbol">(</a><a id="23019" href="/Soundness/#23002" class="Bound">N</a> <a id="23021" href="/Untyped/#7475" class="Function Operator">[</a> <a id="23023" href="/Soundness/#23000" class="Bound">M</a> <a id="23025" href="/Untyped/#7475" class="Function Operator">]</a><a id="23026" class="Symbol">)</a> <a id="23028" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="23030" href="/Soundness/#23005" class="Bound">v</a>
    <a id="23036" class="Symbol">→</a> <a id="23038" href="/Soundness/#22989" class="Bound">γ</a> <a id="23040" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="23042" class="Symbol">(</a><a id="23043" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="23045" href="/Soundness/#23002" class="Bound">N</a><a id="23046" class="Symbol">)</a> <a id="23048" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="23050" href="/Soundness/#23000" class="Bound">M</a> <a id="23052" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="23054" href="/Soundness/#23005" class="Bound">v</a>
<a id="23056" href="/Soundness/#22969" class="Function">reflect-beta</a> <a id="23069" href="/Soundness/#23069" class="Bound">d</a> 
    <a id="23076" class="Keyword">with</a> <a id="23081" href="/Soundness/#22429" class="Function">substitution-reflect</a> <a id="23102" href="/Soundness/#23069" class="Bound">d</a>
<a id="23104" class="Symbol">...</a> <a id="23108" class="Symbol">|</a> <a id="23110" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="23112" href="/Soundness/#23112" class="Bound">v₂&#39;</a> <a id="23116" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="23118" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="23120" href="/Soundness/#23120" class="Bound">d₁&#39;</a> <a id="23124" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="23126" href="/Soundness/#23126" class="Bound">d₂&#39;</a> <a id="23130" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="23132" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="23134" class="Symbol">=</a> <a id="23136" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23143" class="Symbol">(</a><a id="23144" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23152" href="/Soundness/#23126" class="Bound">d₂&#39;</a><a id="23155" class="Symbol">)</a> <a id="23157" href="/Soundness/#23120" class="Bound">d₁&#39;</a> 


<a id="reflect"></a><a id="23164" href="/Soundness/#23164" class="Function">reflect</a> <a id="23172" class="Symbol">:</a> <a id="23174" class="Symbol">∀</a> <a id="23176" class="Symbol">{</a><a id="23177" href="/Soundness/#23177" class="Bound">Γ</a><a id="23178" class="Symbol">}</a> <a id="23180" class="Symbol">{</a><a id="23181" href="/Soundness/#23181" class="Bound">γ</a> <a id="23183" class="Symbol">:</a> <a id="23185" href="/Denotational/#7331" class="Function">Env</a> <a id="23189" href="/Soundness/#23177" class="Bound">Γ</a><a id="23190" class="Symbol">}</a> <a id="23192" class="Symbol">{</a><a id="23193" href="/Soundness/#23193" class="Bound">M</a> <a id="23195" href="/Soundness/#23195" class="Bound">M&#39;</a> <a id="23198" href="/Soundness/#23198" class="Bound">N</a> <a id="23200" href="/Soundness/#23200" class="Bound">v</a><a id="23201" class="Symbol">}</a>
  <a id="23205" class="Symbol">→</a> <a id="23207" href="/Soundness/#23181" class="Bound">γ</a> <a id="23209" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="23211" href="/Soundness/#23198" class="Bound">N</a> <a id="23213" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="23215" href="/Soundness/#23200" class="Bound">v</a>  <a id="23218" class="Symbol">→</a>  <a id="23221" href="/Soundness/#23193" class="Bound">M</a> <a id="23223" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="23226" href="/Soundness/#23195" class="Bound">M&#39;</a>  <a id="23230" class="Symbol">→</a>   <a id="23234" href="/Soundness/#23195" class="Bound">M&#39;</a> <a id="23237" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="23239" href="/Soundness/#23198" class="Bound">N</a>
    <a id="23245" class="Comment">---------------------------------</a>
  <a id="23281" class="Symbol">→</a> <a id="23283" href="/Soundness/#23181" class="Bound">γ</a> <a id="23285" href="/Denotational/#9871" class="Datatype Operator">⊢</a> <a id="23287" href="/Soundness/#23193" class="Bound">M</a> <a id="23289" href="/Denotational/#9871" class="Datatype Operator">↓</a> <a id="23291" href="/Soundness/#23200" class="Bound">v</a>
<a id="23293" href="/Soundness/#23164" class="Function">reflect</a> <a id="23301" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="23305" class="Symbol">(</a><a id="23306" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="23309" href="/Soundness/#23309" class="Bound">r</a><a id="23310" class="Symbol">)</a> <a id="23312" class="Symbol">()</a>
<a id="23315" href="/Soundness/#23164" class="Function">reflect</a> <a id="23323" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="23327" class="Symbol">(</a><a id="23328" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="23331" href="/Soundness/#23331" class="Bound">r</a><a id="23332" class="Symbol">)</a> <a id="23334" class="Symbol">()</a>
<a id="23337" href="/Soundness/#23164" class="Function">reflect</a><a id="23344" class="Symbol">{</a><a id="23345" class="Argument">γ</a> <a id="23347" class="Symbol">=</a> <a id="23349" href="/Soundness/#23349" class="Bound">γ</a><a id="23350" class="Symbol">}</a> <a id="23352" class="Symbol">(</a><a id="23353" href="/Denotational/#9925" class="InductiveConstructor">var</a><a id="23356" class="Symbol">{</a><a id="23357" class="Argument">x</a> <a id="23359" class="Symbol">=</a> <a id="23361" href="/Soundness/#23361" class="Bound">x</a><a id="23362" class="Symbol">})</a> <a id="23365" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="23367" href="/Soundness/#23367" class="Bound">mn</a>
    <a id="23374" class="Keyword">with</a> <a id="23379" href="/Denotational/#9925" class="InductiveConstructor">var</a><a id="23382" class="Symbol">{</a><a id="23383" class="Argument">γ</a> <a id="23385" class="Symbol">=</a> <a id="23387" href="/Soundness/#23349" class="Bound">γ</a><a id="23388" class="Symbol">}{</a><a id="23390" class="Argument">x</a> <a id="23392" class="Symbol">=</a> <a id="23394" href="/Soundness/#23361" class="Bound">x</a><a id="23395" class="Symbol">}</a>
<a id="23397" class="Symbol">...</a> <a id="23401" class="Symbol">|</a> <a id="23403" href="/Soundness/#23403" class="Bound">d&#39;</a> <a id="23406" class="Keyword">rewrite</a> <a id="23414" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23418" class="Bound">mn</a> <a id="23421" class="Symbol">=</a> <a id="23423" href="/Soundness/#22969" class="Function">reflect-beta</a> <a id="23436" href="/Soundness/#23403" class="Bound">d&#39;</a> 
<a id="23440" href="/Soundness/#23164" class="Function">reflect</a> <a id="23448" href="/Denotational/#9925" class="InductiveConstructor">var</a> <a id="23452" class="Symbol">(</a><a id="23453" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="23455" href="/Soundness/#23455" class="Bound">r</a><a id="23456" class="Symbol">)</a> <a id="23458" class="Symbol">()</a>
<a id="23461" href="/Soundness/#23164" class="Function">reflect</a> <a id="23469" class="Symbol">(</a><a id="23470" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23477" href="/Soundness/#23477" class="Bound">d₁</a> <a id="23480" href="/Soundness/#23480" class="Bound">d₂</a><a id="23482" class="Symbol">)</a> <a id="23484" class="Symbol">(</a><a id="23485" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="23488" href="/Soundness/#23488" class="Bound">r</a><a id="23489" class="Symbol">)</a> <a id="23491" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23496" class="Symbol">=</a> <a id="23498" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23505" class="Symbol">(</a><a id="23506" href="/Soundness/#23164" class="Function">reflect</a> <a id="23514" href="/Soundness/#23477" class="Bound">d₁</a> <a id="23517" href="/Soundness/#23488" class="Bound">r</a> <a id="23519" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23523" class="Symbol">)</a> <a id="23525" href="/Soundness/#23480" class="Bound">d₂</a> 
<a id="23529" href="/Soundness/#23164" class="Function">reflect</a> <a id="23537" class="Symbol">(</a><a id="23538" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23545" href="/Soundness/#23545" class="Bound">d₁</a> <a id="23548" href="/Soundness/#23548" class="Bound">d₂</a><a id="23550" class="Symbol">)</a> <a id="23552" class="Symbol">(</a><a id="23553" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="23556" href="/Soundness/#23556" class="Bound">r</a><a id="23557" class="Symbol">)</a> <a id="23559" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23564" class="Symbol">=</a> <a id="23566" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23573" href="/Soundness/#23545" class="Bound">d₁</a> <a id="23576" class="Symbol">(</a><a id="23577" href="/Soundness/#23164" class="Function">reflect</a> <a id="23585" href="/Soundness/#23548" class="Bound">d₂</a> <a id="23588" href="/Soundness/#23556" class="Bound">r</a> <a id="23590" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23594" class="Symbol">)</a> 
<a id="23597" href="/Soundness/#23164" class="Function">reflect</a> <a id="23605" class="Symbol">(</a><a id="23606" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23613" href="/Soundness/#23613" class="Bound">d₁</a> <a id="23616" href="/Soundness/#23616" class="Bound">d₂</a><a id="23618" class="Symbol">)</a> <a id="23620" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="23622" href="/Soundness/#23622" class="Bound">mn</a>
    <a id="23629" class="Keyword">with</a> <a id="23634" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23641" href="/Soundness/#23613" class="Bound">d₁</a> <a id="23644" href="/Soundness/#23616" class="Bound">d₂</a>
<a id="23647" class="Symbol">...</a> <a id="23651" class="Symbol">|</a> <a id="23653" href="/Soundness/#23653" class="Bound">d&#39;</a> <a id="23656" class="Keyword">rewrite</a> <a id="23664" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23668" class="Bound">mn</a> <a id="23671" class="Symbol">=</a> <a id="23673" href="/Soundness/#22969" class="Function">reflect-beta</a> <a id="23686" href="/Soundness/#23653" class="Bound">d&#39;</a>
<a id="23689" href="/Soundness/#23164" class="Function">reflect</a> <a id="23697" class="Symbol">(</a><a id="23698" href="/Denotational/#10004" class="InductiveConstructor">↦-elim</a> <a id="23705" href="/Soundness/#23705" class="Bound">d₁</a> <a id="23708" href="/Soundness/#23708" class="Bound">d₂</a><a id="23710" class="Symbol">)</a> <a id="23712" class="Symbol">(</a><a id="23713" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="23715" href="/Soundness/#23715" class="Bound">r</a><a id="23716" class="Symbol">)</a> <a id="23718" class="Symbol">()</a>
<a id="23721" href="/Soundness/#23164" class="Function">reflect</a> <a id="23729" class="Symbol">(</a><a id="23730" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23738" href="/Soundness/#23738" class="Bound">d</a><a id="23739" class="Symbol">)</a> <a id="23741" class="Symbol">(</a><a id="23742" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="23745" href="/Soundness/#23745" class="Bound">r</a><a id="23746" class="Symbol">)</a> <a id="23748" class="Symbol">()</a>
<a id="23751" href="/Soundness/#23164" class="Function">reflect</a> <a id="23759" class="Symbol">(</a><a id="23760" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23768" href="/Soundness/#23768" class="Bound">d</a><a id="23769" class="Symbol">)</a> <a id="23771" class="Symbol">(</a><a id="23772" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="23775" href="/Soundness/#23775" class="Bound">r</a><a id="23776" class="Symbol">)</a> <a id="23778" class="Symbol">()</a>
<a id="23781" href="/Soundness/#23164" class="Function">reflect</a> <a id="23789" class="Symbol">(</a><a id="23790" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23798" href="/Soundness/#23798" class="Bound">d</a><a id="23799" class="Symbol">)</a> <a id="23801" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="23803" href="/Soundness/#23803" class="Bound">mn</a>
    <a id="23810" class="Keyword">with</a> <a id="23815" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23823" href="/Soundness/#23798" class="Bound">d</a>
<a id="23825" class="Symbol">...</a> <a id="23829" class="Symbol">|</a> <a id="23831" href="/Soundness/#23831" class="Bound">d&#39;</a> <a id="23834" class="Keyword">rewrite</a> <a id="23842" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23846" class="Bound">mn</a> <a id="23849" class="Symbol">=</a> <a id="23851" href="/Soundness/#22969" class="Function">reflect-beta</a> <a id="23864" href="/Soundness/#23831" class="Bound">d&#39;</a>
<a id="23867" href="/Soundness/#23164" class="Function">reflect</a> <a id="23875" class="Symbol">(</a><a id="23876" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23884" href="/Soundness/#23884" class="Bound">d</a><a id="23885" class="Symbol">)</a> <a id="23887" class="Symbol">(</a><a id="23888" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="23890" href="/Soundness/#23890" class="Bound">r</a><a id="23891" class="Symbol">)</a> <a id="23893" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23898" class="Symbol">=</a> <a id="23900" href="/Denotational/#10142" class="InductiveConstructor">↦-intro</a> <a id="23908" class="Symbol">(</a><a id="23909" href="/Soundness/#23164" class="Function">reflect</a> <a id="23917" href="/Soundness/#23884" class="Bound">d</a> <a id="23919" href="/Soundness/#23890" class="Bound">r</a> <a id="23921" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23925" class="Symbol">)</a>
<a id="23927" href="/Soundness/#23164" class="Function">reflect</a> <a id="23935" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a> <a id="23943" href="/Soundness/#23943" class="Bound">r</a> <a id="23945" href="/Soundness/#23945" class="Bound">mn</a> <a id="23948" class="Symbol">=</a> <a id="23950" href="/Denotational/#10266" class="InductiveConstructor">⊥-intro</a>
<a id="23958" href="/Soundness/#23164" class="Function">reflect</a> <a id="23966" class="Symbol">(</a><a id="23967" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="23975" href="/Soundness/#23975" class="Bound">d₁</a> <a id="23978" href="/Soundness/#23978" class="Bound">d₂</a><a id="23980" class="Symbol">)</a> <a id="23982" href="/Soundness/#23982" class="Bound">r</a> <a id="23984" href="/Soundness/#23984" class="Bound">mn</a> <a id="23987" class="Keyword">rewrite</a> <a id="23995" href="https://agda.github.io/agda-stdlib/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23999" href="/Soundness/#23984" class="Bound">mn</a> <a id="24002" class="Symbol">=</a>
   <a id="24007" href="/Denotational/#10341" class="InductiveConstructor">⊔-intro</a> <a id="24015" class="Symbol">(</a><a id="24016" href="/Soundness/#23164" class="Function">reflect</a> <a id="24024" href="/Soundness/#23975" class="Bound">d₁</a> <a id="24027" href="/Soundness/#23982" class="Bound">r</a> <a id="24029" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="24033" class="Symbol">)</a> <a id="24035" class="Symbol">(</a><a id="24036" href="/Soundness/#23164" class="Function">reflect</a> <a id="24044" href="/Soundness/#23978" class="Bound">d₂</a> <a id="24047" href="/Soundness/#23982" class="Bound">r</a> <a id="24049" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="24053" class="Symbol">)</a>
<a id="24055" href="/Soundness/#23164" class="Function">reflect</a> <a id="24063" class="Symbol">(</a><a id="24064" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="24068" href="/Soundness/#24068" class="Bound">d</a> <a id="24070" href="/Soundness/#24070" class="Bound">lt</a><a id="24072" class="Symbol">)</a> <a id="24074" href="/Soundness/#24074" class="Bound">r</a> <a id="24076" href="/Soundness/#24076" class="Bound">mn</a> <a id="24079" class="Symbol">=</a> <a id="24081" href="/Denotational/#10477" class="InductiveConstructor">sub</a> <a id="24085" class="Symbol">(</a><a id="24086" href="/Soundness/#23164" class="Function">reflect</a> <a id="24094" href="/Soundness/#24068" class="Bound">d</a> <a id="24096" href="/Soundness/#24074" class="Bound">r</a> <a id="24098" href="/Soundness/#24076" class="Bound">mn</a><a id="24100" class="Symbol">)</a> <a id="24102" href="/Soundness/#24070" class="Bound">lt</a></pre>

<h2 id="reduction-implies-denotational-equality">Reduction implies denotational equality</h2>

<p>We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.</p>

<pre class="Agda"><a id="reduce-equal"></a><a id="24294" href="/Soundness/#24294" class="Function">reduce-equal</a> <a id="24307" class="Symbol">:</a> <a id="24309" class="Symbol">∀</a> <a id="24311" class="Symbol">{</a><a id="24312" href="/Soundness/#24312" class="Bound">Γ</a><a id="24313" class="Symbol">}</a> <a id="24315" class="Symbol">{</a><a id="24316" href="/Soundness/#24316" class="Bound">M</a> <a id="24318" class="Symbol">:</a> <a id="24320" href="/Soundness/#24312" class="Bound">Γ</a> <a id="24322" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24324" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24325" class="Symbol">}</a> <a id="24327" class="Symbol">{</a><a id="24328" href="/Soundness/#24328" class="Bound">N</a> <a id="24330" class="Symbol">:</a> <a id="24332" href="/Soundness/#24312" class="Bound">Γ</a> <a id="24334" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24336" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24337" class="Symbol">}</a>
  <a id="24341" class="Symbol">→</a> <a id="24343" href="/Soundness/#24316" class="Bound">M</a> <a id="24345" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="24348" href="/Soundness/#24328" class="Bound">N</a>
    <a id="24354" class="Comment">---------</a>
  <a id="24366" class="Symbol">→</a> <a id="24368" href="/Denotational/#18349" class="Function">ℰ</a> <a id="24370" href="/Soundness/#24316" class="Bound">M</a> <a id="24372" href="/Denotational/#18547" class="Function Operator">≃</a> <a id="24374" href="/Denotational/#18349" class="Function">ℰ</a> <a id="24376" href="/Soundness/#24328" class="Bound">N</a>
<a id="24378" href="/Soundness/#24294" class="Function">reduce-equal</a> <a id="24391" class="Symbol">{</a><a id="24392" href="/Soundness/#24392" class="Bound">Γ</a><a id="24393" class="Symbol">}{</a><a id="24395" href="/Soundness/#24395" class="Bound">M</a><a id="24396" class="Symbol">}{</a><a id="24398" href="/Soundness/#24398" class="Bound">N</a><a id="24399" class="Symbol">}</a> <a id="24401" href="/Soundness/#24401" class="Bound">r</a> <a id="24403" href="/Soundness/#24403" class="Bound">γ</a> <a id="24405" href="/Soundness/#24405" class="Bound">v</a> <a id="24407" class="Symbol">=</a>
    <a id="24413" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="24415" class="Symbol">(λ</a> <a id="24418" href="/Soundness/#24418" class="Bound">m</a> <a id="24420" class="Symbol">→</a> <a id="24422" href="/Soundness/#6686" class="Function">preserve</a> <a id="24431" href="/Soundness/#24418" class="Bound">m</a> <a id="24433" href="/Soundness/#24401" class="Bound">r</a><a id="24434" class="Symbol">)</a> <a id="24436" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="24438" class="Symbol">(λ</a> <a id="24441" href="/Soundness/#24441" class="Bound">n</a> <a id="24443" class="Symbol">→</a> <a id="24445" href="/Soundness/#23164" class="Function">reflect</a> <a id="24453" href="/Soundness/#24441" class="Bound">n</a> <a id="24455" href="/Soundness/#24401" class="Bound">r</a> <a id="24457" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="24461" class="Symbol">)</a> <a id="24463" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<p>We conclude with the <em>soundness property</em>, that multi-step reduction
to a lambda abstraction implies denotational equivalence with a lambda
abstraction.</p>

<pre class="Agda"><a id="soundness"></a><a id="24644" href="/Soundness/#24644" class="Function">soundness</a> <a id="24654" class="Symbol">:</a> <a id="24656" class="Symbol">∀{</a><a id="24658" href="/Soundness/#24658" class="Bound">Γ</a><a id="24659" class="Symbol">}</a> <a id="24661" class="Symbol">{</a><a id="24662" href="/Soundness/#24662" class="Bound">M</a> <a id="24664" class="Symbol">:</a> <a id="24666" href="/Soundness/#24658" class="Bound">Γ</a> <a id="24668" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24670" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24671" class="Symbol">}</a> <a id="24673" class="Symbol">{</a><a id="24674" href="/Soundness/#24674" class="Bound">N</a> <a id="24676" class="Symbol">:</a> <a id="24678" href="/Soundness/#24658" class="Bound">Γ</a> <a id="24680" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="24682" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="24684" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24686" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24687" class="Symbol">}</a>
  <a id="24691" class="Symbol">→</a> <a id="24693" href="/Soundness/#24662" class="Bound">M</a> <a id="24695" href="/LambdaReduction/#894" class="Datatype Operator">—↠</a> <a id="24698" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24700" href="/Soundness/#24674" class="Bound">N</a>
    <a id="24706" class="Comment">-----------------</a>
  <a id="24726" class="Symbol">→</a> <a id="24728" href="/Denotational/#18349" class="Function">ℰ</a> <a id="24730" href="/Soundness/#24662" class="Bound">M</a> <a id="24732" href="/Denotational/#18547" class="Function Operator">≃</a> <a id="24734" href="/Denotational/#18349" class="Function">ℰ</a> <a id="24736" class="Symbol">(</a><a id="24737" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24739" href="/Soundness/#24674" class="Bound">N</a><a id="24740" class="Symbol">)</a>
<a id="24742" href="/Soundness/#24644" class="Function">soundness</a> <a id="24752" class="Symbol">(</a><a id="24753" class="DottedPattern Symbol">.(</a><a id="24755" href="/Untyped/#4238" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="24757" class="DottedPattern Symbol">_)</a> <a id="24760" href="/LambdaReduction/#944" class="InductiveConstructor Operator">[]</a><a id="24762" class="Symbol">)</a> <a id="24764" href="/Soundness/#24764" class="Bound">γ</a> <a id="24766" href="/Soundness/#24766" class="Bound">v</a> <a id="24768" class="Symbol">=</a> <a id="24770" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="24772" class="Symbol">(λ</a> <a id="24775" href="/Soundness/#24775" class="Bound">x</a> <a id="24777" class="Symbol">→</a> <a id="24779" href="/Soundness/#24775" class="Bound">x</a><a id="24780" class="Symbol">)</a> <a id="24782" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="24784" class="Symbol">(λ</a> <a id="24787" href="/Soundness/#24787" class="Bound">x</a> <a id="24789" class="Symbol">→</a> <a id="24791" href="/Soundness/#24787" class="Bound">x</a><a id="24792" class="Symbol">)</a> <a id="24794" href="https://agda.github.io/agda-stdlib/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="24796" href="/Soundness/#24644" class="Function">soundness</a> <a id="24806" class="Symbol">{</a><a id="24807" href="/Soundness/#24807" class="Bound">Γ</a><a id="24808" class="Symbol">}</a> <a id="24810" class="Symbol">(</a><a id="24811" href="/Soundness/#24811" class="Bound">L</a> <a id="24813" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">—→⟨</a> <a id="24817" href="/Soundness/#24817" class="Bound">r</a> <a id="24819" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">⟩</a> <a id="24821" href="/Soundness/#24821" class="Bound">M—↠N</a><a id="24825" class="Symbol">)</a> <a id="24827" href="/Soundness/#24827" class="Bound">γ</a> <a id="24829" href="/Soundness/#24829" class="Bound">v</a> <a id="24831" class="Symbol">=</a>
   <a id="24836" class="Keyword">let</a> <a id="24840" href="/Soundness/#24840" class="Bound">ih</a> <a id="24843" class="Symbol">=</a> <a id="24845" href="/Soundness/#24644" class="Function">soundness</a> <a id="24855" href="/Soundness/#24821" class="Bound">M—↠N</a> <a id="24860" class="Keyword">in</a>
   <a id="24866" class="Keyword">let</a> <a id="24870" href="/Soundness/#24870" class="Bound">e</a> <a id="24872" class="Symbol">=</a> <a id="24874" href="/Soundness/#24294" class="Function">reduce-equal</a> <a id="24887" href="/Soundness/#24817" class="Bound">r</a> <a id="24889" class="Keyword">in</a>
   <a id="24895" href="/Denotational/#18968" class="Function">≃-trans</a> <a id="24903" class="Symbol">{</a><a id="24904" href="/Soundness/#24807" class="Bound">Γ</a><a id="24905" class="Symbol">}</a> <a id="24907" href="/Soundness/#24870" class="Bound">e</a> <a id="24909" href="/Soundness/#24840" class="Bound">ih</a> <a id="24912" href="/Soundness/#24827" class="Bound">γ</a> <a id="24914" href="/Soundness/#24829" class="Bound">v</a></pre>


  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>

<!-- Script which allows for foldable code blocks -->
<script type="text/javascript">
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
